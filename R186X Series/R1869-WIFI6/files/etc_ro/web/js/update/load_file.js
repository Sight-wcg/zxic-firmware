define(["jquery","lib/jquery/jQuery.fileinput","service","knockout","config/config","status/statusBar"],function(b,l,q,a,o,j){function n(){var s=this;s.hasWifi=a.observable(o.HAS_WIFI);s.hasUssd=o.HAS_USSD;s.hasUpdateCheck=o.HAS_UPDATE_CHECK;s.hasDdns=o.DDNS_SUPPORT;s.hasVlan=o.HAS_VLAN;document.querySelector("#save").addEventListener("click",i)}function m(t){var s=document.createEvent("MouseEvents");s.initMouseEvent("click",true,false,window,0,0,0,0,0,false,false,false,false,0,null);t.dispatchEvent(s)}function d(u,x){var w=window.URL||window.webkitURL||window;var y=new Blob([x]);var t=navigator.userAgent;var v=!!window.ActiveXObject||"ActiveXObject" in window;if(v){window.navigator.msSaveOrOpenBlob(y,u)}else{var s=document.createElementNS("http://www.w3.org/1999/xhtml","a");s.href=w.createObjectURL(y);s.download=u;m(s)}}function i(){var t={};var s=null;q.readConfig(t,function(u){if(u.result!="0"){s=u.result;d("setting.db",s);successOverlay()}else{errorOverlay()}})}function g(x){var t=0;var u=/msie/i.test(navigator.userAgent)&&!window.opera;if(u){var s=x.value;try{var v=new ActiveXObject("Scripting.FileSystemObject");t=parseInt(v.GetFile(s).size)}catch(w){t=1}}else{try{t=parseInt(x.files[0].size)}catch(w){t=1}}return t}fileUploadSubmitClickHandler=function(t){if(t){var v=b.trim(b("div#confirm div.promptDiv input#promptInput").val())}else{var v=b(".customfile").attr("title")}var u=("/etc_rw/"+v).replace("//","/");var s=g(b("#fileField")[0]);if(!r(v,u,s)){return false}b("#fileUploadForm").attr("action","/remo/config/"+URLEncodeComponent(v));showLoading("uploading",'<span data-trans="upload_tip">'+b.i18n.prop("upload_tip")+"</span>");if(!c){e()}b("#fileUploadForm").submit()};var c=false;function e(){c=true;b("#fileUploadIframe").load(function(){sdIsUploading=false;var t=b("#fileUploadIframe").contents().find("body").html().toLowerCase();var s=false;if(t.indexOf("success")!=-1){successOverlay();showAlert("setsucc_reboot");restartDevice(q)}else{if(t.indexOf("space_not_enough")!=-1){s=true;showAlert("sd_upload_space_not_enough")}else{if(t.indexOf("data_lost")!=-1){s=true;showAlert("sd_upload_data_lost")}else{errorOverlay()}}}f()})}function f(){b("#fileField").closest(".customfile").before('<input id="fileField" name="filename" maxlength="200" type="file" dir="ltr"/>').remove();addTimeout(function(){b("#fileField").customFileInput()},0);b("#uploadBtn","#uploadSection").attr("data-trans","browse_btn").html(b.i18n.prop("browse_btn"));b(".customfile","#uploadSection").removeAttr("title");b(".customfile span.customfile-feedback","#uploadSection").html('<span data-trans="no_file_selected">'+b.i18n.prop("no_file_selected")+"</span>").attr("class","customfile-feedback")}updateSdMemorySizes=function(){q.getSdMemorySizes({},function(u){if(isErrorObject(u)){showAlert(u.errorType);return false}var t=getDisplayVolume(u.totalMemorySize,false);var s=getDisplayVolume(u.totalMemorySize-u.availableMemorySize,false);b("#sd_volumn_used").text(s);b("#sd_volumn_total").text(t);return true})};pagination=function(s){var t=generatePager(s,perPage,parseInt(activePage,10));if(pagerTmpl==null){pagerTmpl=b.template("pagerTmpl",b("#pagerTmpl"))}b(".pager","#fileListButtonSection").html(b.tmpl("pagerTmpl",{data:{pagers:t,total:getTotalPages(s,perPage)}}));renderCheckbox();b(".content","#httpshare_form").translate()};function h(s,t){if(s==""||s.length>25){return 1}if(t.length>=200){return 2}if(!p(s,false)){return 3}}function r(u,t,s){if(typeof u=="undefined"||u==""||u==b.i18n.prop("no_file_selected")){showAlert("sd_no_file_selected");return false}if(u!="setting.db"){showAlert("config_file_name_error");return false}if(t.length>=200){showAlert("sd_card_path_too_long");return false}if(s>4096){showAlert("config_file_size_too_big");return false}if(u.indexOf("*")>=0){showAlert("sd_file_name_invalid");return false}return true}function p(u,x){var w="+/:*?<>\"'\\|#&`~";if(x){w="+:*?<>\"'\\|#&`~"}var s=false;var z=false;var y=/^\.+$/;for(var t=0;t<u.length;t++){for(var v=0;v<w.length;v++){if(u.charAt(t)==w.charAt(v)){s=true;break}}if(y.test(u)){z=true}if(s||z){return false}}return true}checkFilePathForDownload=function(v){if(!checkConfiguration()){return false}var s=v.lastIndexOf("/");var t=v.substring(0,s+1);var u=v.substring(s+1,v.length);if(p(t,true)&&p(u,false)){return true}showAlert("sd_card_invalid_chars_cant_download");return false};gotoLogin=function(){window.location.href="#login"};self.isShowFotaSwitch=a.observable(false);if(q.getfotaswitch().remo_fota_switch=="1"){self.isShowFotaSwitch(true)}else{self.isShowFotaSwitch(false)}function k(){var s=b("#container")[0];a.cleanNode(s);var t=new n();a.applyBindings(t,s);if(b(".customfile").length==0){b("#fileField").customFileInput()}}return{init:k}});