define(["jquery","knockout","config/config","service"],function(g,p,b,h){var q="";function n(){var r=this;var s=a();r.ipAddress=p.observable(s.ipAddress);r.subnetMask=p.observable(s.subnetMask);r.macAddress=p.observable(s.macAddress);r.dhcpServer=p.observable(s.dhcpServer);r.dhcpStart=p.observable(s.dhcpStart);r.dhcpEnd=p.observable(s.dhcpEnd);r.dhcpLease=p.observable(s.dhcpLease);r.showMacAddress=p.observable(b.SHOW_MAC_ADDRESS);r.hasWifi=p.observable(b.HAS_WIFI);r.hasUssd=b.HAS_USSD;r.hasUpdateCheck=b.HAS_UPDATE_CHECK;r.hasDdns=b.DDNS_SUPPORT;r.refreshStatus=function(){var t=h.getConnectionInfo();if(t.connectStatus=="ppp_disconnected"){g("input","#frmLan").each(function(){g(this).attr("disabled",false)})}else{g("input","#frmLan").each(function(){g(this).attr("disabled",true)});clearValidateMsg()}};r.clear=function(){clearTimer();o();clearValidateMsg()};r.save=function(){var t=g("#frmLan").serialize();if(t==q){showAlert("setting_no_change");return false}if(b.RJ45_SUPPORT){var u=h.getPppoeParams();if(m(u.static_wan_ipaddr,r.ipAddress(),r.subnetMask())){showAlert("lan_tip_staticip_notsame");return false}}showConfirm("lan_confirm_reopen",function(){r.saveAct()})};r.saveAct=function(){showLoading();var t={ipAddress:r.ipAddress(),subnetMask:r.subnetMask(),dhcpServer:r.dhcpServer(),dhcpStart:g("#txtDhcpIpPoolStart").val(),dhcpEnd:g("#txtDhcpIpPoolEnd").val(),dhcpLease:r.dhcpLease()};h.setLanInfo(t,function(u){if(u.result=="success"){successOverlay();r.clear()}else{errorOverlay()}})};r.refreshStatus();r.dhcpServerHandler=function(){g("#txtIpAddress").parent().find(".error").hide();g("#txtIpAddress").show();return true};addTimeout(function(){q=g("#frmLan").serialize()},500)}function a(){return h.getLanInfo()}function o(){var r=g("#container");p.cleanNode(r[0]);var s=new n();p.applyBindings(s,r[0]);addInterval(s.refreshStatus,1000);g("#frmLan").validate({submitHandler:function(){s.save()},rules:{txtIpAddress:{lanip_check:true,ipRange:true,modifyIpPool:true},txtSubnetMask:{ipv4:true,subnetmask_check:true},txtDhcpIpPoolStart:{lanip_check:true,dhcp_check:"start",dhcpCompare:"#txtDhcpIpPoolEnd"},txtDhcpIpPoolEnd:{lanip_check:true,dhcp_check:"end",dhcpCompare:"#txtDhcpIpPoolStart"},txtDhcpLease:{range:[1,65535],digits:true}},groups:{lanip_check:"txtDhcpIpPoolStart txtDhcpIpPoolEnd"},errorPlacement:function(t,u){if(u.attr("name")=="txtDhcpIpPoolStart"){t.insertAfter("#txtDhcpIpPoolEnd")}else{if(u.attr("name")=="txtDhcpLease"){t.insertAfter("#errorHolder")}else{t.insertAfter(u)}}}})}g.validator.addMethod("subnetmask_check",function(t,s,u){var r=l(t);return this.optional(s)||r});g.validator.addMethod("dhcp_check",function(u,t,v){var s=v=="start"?g("#txtDhcpIpPoolStart").val():g("#txtDhcpIpPoolEnd").val();var r=f(g("#txtIpAddress").val(),g("#txtSubnetMask").val(),s);return this.optional(t)||r});g.validator.addMethod("dhcpCompare",function(t,s,u){var r;if(u=="#txtDhcpIpPoolStart"){r=e(g("#txtIpAddress").val(),g("#txtSubnetMask").val(),g(u).val(),t)}else{r=e(g("#txtIpAddress").val(),g("#txtSubnetMask").val(),t,g(u).val())}return r!=1});g.validator.addMethod("ipRange",function(u,t,v){var s=false;if(g("#dhcpEnable").is(":checked")){s=true}var r=e(u,g("#txtSubnetMask").val(),g("#txtDhcpIpPoolStart").val(),g("#txtDhcpIpPoolEnd").val(),s);return r!=2});g.validator.addMethod("modifyIpPool",function(u,t,v){var r=f(g("#txtIpAddress").val(),g("#txtSubnetMask").val(),g("#txtDhcpIpPoolStart").val());if(r!=true){var s=c(g("#txtIpAddress").val(),g("#txtSubnetMask").val(),g("#txtDhcpIpPoolStart").val());g("#txtDhcpIpPoolStart").val(s)}r=f(g("#txtIpAddress").val(),g("#txtSubnetMask").val(),g("#txtDhcpIpPoolEnd").val());if(r!=true){var s=c(g("#txtIpAddress").val(),g("#txtSubnetMask").val(),g("#txtDhcpIpPoolEnd").val());g("#txtDhcpIpPoolEnd").val(s)}return true});function m(x,t,s){if(!x||!t||!s){return false}if(x==t){return true}var w=[],v=[],r=[];addr1=x.split(".");addr2=t.split(".");r=s.split(".");for(var u=0;u<addr1.length;u+=1){w.push(parseInt(addr1[u])&parseInt(r[u]));v.push(parseInt(addr2[u])&parseInt(r[u]))}if(w.join(".")==v.join(".")){return true}else{return false}}function l(r){var s=r.split(".");if(s.length!=4){return false}s[0]=parseInt(s[0]);s[1]=parseInt(s[1]);s[2]=parseInt(s[2]);s[3]=parseInt(s[3]);if(s[3]!=0){if(s[2]!=255||s[1]!=255||s[0]!=255){return false}else{if(!i(s[3])){return false}}}if(s[2]!=0){if(s[1]!=255||s[0]!=255){return false}else{if(!i(s[2])){return false}}}if(s[1]!=0){if(s[0]!=255){return false}else{if(!i(s[1])){return false}}}if(s[0]!=255){return false}if("0.0.0.0"==r||"255.255.255.255"==r){return false}return true}function i(r){return(r==255||r==254||r==252||r==248||r==240||r==224||r==192||r==128||r==0)}function f(E,v,y){var w,u,t,z,A,D;var x,C,B,s,r;w=E.indexOf(".");u=E.indexOf(".",(w+1));t=E.indexOf(".",(u+1));z=d(E.substring(0,w))+d(E.substring((w+1),u))+d(E.substring((u+1),t))+d(E.substring((t+1),E.length));z="0x"+z;x=E.substring((t+1),E.length)-0;w=v.indexOf(".");u=v.indexOf(".",(w+1));t=v.indexOf(".",(u+1));A=d(v.substring(0,w))+d(v.substring((w+1),u))+d(v.substring((u+1),t))+d(v.substring((t+1),v.length));A="0x"+A;C=v.substring((t+1),v.length)-0;w=y.indexOf(".");u=y.indexOf(".",(w+1));t=y.indexOf(".",(u+1));D=d(y.substring(0,w))+d(y.substring((w+1),u))+d(y.substring((u+1),t))+d(y.substring((t+1),y.length));D="0x"+D;B=y.substring((t+1),y.length)-0;if(k(z,A)!=k(D,A)){return false}s=(x&C);r=(x&C)+(255-C);return !(B==s||B==r)}function d(s){var r=(s-0).toString(16);if(r.length==1){r="0"+r}return r.toUpperCase()}function k(w,v){var s;var u=[];var t=[];var r="0x";for(s=2,j=0;s<10;s+=2,j++){u[j]="0x"+w.substring(s,s+2);t[j]="0x"+v.substring(s,s+2)}for(s=0;s<4;s++){r=r+d(u[s]&t[s])}return r-0}function e(u,s,w,v,t){i1=w.indexOf(".");i2=w.indexOf(".",(i1+1));i3=w.indexOf(".",(i2+1));sip=d(w.substring(0,i1))+d(w.substring((i1+1),i2))+d(w.substring((i2+1),i3))+d(w.substring((i3+1),w.length));sip="0x"+sip;i1=v.indexOf(".");i2=v.indexOf(".",(i1+1));i3=v.indexOf(".",(i2+1));eip=d(v.substring(0,i1))+d(v.substring((i1+1),i2))+d(v.substring((i2+1),i3))+d(v.substring((i3+1),v.length));eip="0x"+eip;i1=u.indexOf(".");i2=u.indexOf(".",(i1+1));i3=u.indexOf(".",(i2+1));var r="0x"+d(u.substring(0,i1))+d(u.substring((i1+1),i2))+d(u.substring((i2+1),i3))+d(parseInt(u.substring((i3+1),u.length))+18);u=d(u.substring(0,i1))+d(u.substring((i1+1),i2))+d(u.substring((i2+1),i3))+d(u.substring((i3+1),u.length));u="0x"+u;if(sip>eip){return 1}if(u>=sip&&u<=eip){return 2}return 0}function c(G,w,B){var x,v,u;var y,E,D,t,r;x=G.indexOf(".");v=G.indexOf(".",(x+1));u=G.indexOf(".",(v+1));var A=[G.substring(0,x),G.substring((x+1),v),G.substring((v+1),u),G.substring((u+1),G.length)];x=w.indexOf(".");v=w.indexOf(".",(x+1));u=w.indexOf(".",(v+1));var C=[w.substring(0,x),w.substring((x+1),v),w.substring((v+1),u),w.substring((u+1),w.length)];x=B.indexOf(".");v=B.indexOf(".",(x+1));u=B.indexOf(".",(v+1));var F=[B.substring(0,x),B.substring((x+1),v),B.substring((v+1),u),B.substring((u+1),B.length)];var s=[];for(var z=0;z<4;z++){s[z]=(A[z]&C[z])|(F[z]&~C[z])}return s[0]+"."+s[1]+"."+s[2]+"."+s[3]}self.isShowFotaSwitch=p.observable(false);if(h.getfotaswitch().remo_fota_switch=="1"){self.isShowFotaSwitch(true)}else{self.isShowFotaSwitch(false)}return{init:o}});