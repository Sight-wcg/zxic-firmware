define(["jquery","knockout","config/config","service","underscore"],function(f,e,d,a,c){function b(){var h=this;h.currentPassword=e.observable();h.newPassword=e.observable();h.confirmPassword=e.observable();h.changePassword=function(){var i={oldPassword:h.currentPassword(),newPassword:h.newPassword()};showLoading();a.changePassword(i,function(j){h.cancel();if(j&&j.result==true){successOverlay();a.logout({},function(){if(a.pageIsMobile()){window.location="index_mobile.html"}else{window.location="index.html"}})}else{if(j&&j.errorType=="badPassword"){hideLoading();showAlert("current_password_error",function(){f("#txtCurrentPassword").focus()})}else{errorOverlay()}}})};h.cancel=function(){h.currentPassword("");h.newPassword("");h.confirmPassword("")}}function g(){var h=f("#container");e.cleanNode(h[0]);var i=new b();e.applyBindings(i,h[0]);f("#frmPassword").validate({submitHandler:function(){i.changePassword()},rules:{txtCurrentPassword:"password_check",txtNewPassword:"password_check",txtConfirmPassword:{equalToPassword:"#txtNewPassword"}}})}return{init:g}});