define(["jquery","knockout","config/config","service","underscore"],function(f,l,b,g,i){var m={ok:0,wps_on:1,wifi_off:2};var d={auto:"auto",manual:"manual"};var e=1;var a=5;function c(){return i.map(b.APN_AUTH_MODES,function(n){return new Option(n.name,n.value)})}var j=i.map(b.WIFI_WEP_SUPPORT?b.AUTH_MODES_WEP:b.AUTH_MODES,function(n){return new Option(n.name,n.value)});function h(){var q=this;var u=g.getQuickSettingInfo();q.supportIPv6=b.IPV6_SUPPORT;q.supportIpv4AndIpv6=b.IPV4_AND_V6_SUPPORT;q.currentStep=l.observable(e);q.currAPN=l.computed(function(){var x=u["APN_configtmp"+u.apn_index];var w=[];if(x){w=x.split("($)")}var v=u["ipv6_APN_configtmp"+u.apn_index];var y=[];if(v){y=v.split("($)")}return{remo_pdp_type:w[7]=="IP"?w[7]:y[7],m_profile_name:w[0],wan_apn:w[1],pdp_type:w[7],ppp_auth_mode:w[4]==""||typeof(w[4])=="undefined"?"":w[4].toLowerCase(),ppp_username:w[5],ppp_passtmp:w[6],ipv6_pdp_type:y[7],ipv6_wan_apn:y[1],ipv6_ppp_auth_mode:typeof(y[4])=="undefined"||y[4]==""?"":y[4].toLowerCase(),ipv6_ppp_username:y[5],ipv6_ppp_passtmp:y[6]}});q.wpsFlag=l.observable(u.WscModeOption);q.apnMode=l.observable(u.apn_mode);q.profileName=l.observable(q.currAPN().m_profile_name);q.apn=l.observable(q.currAPN().wan_apn);q.ipv6_apn=l.observable(q.currAPN().ipv6_wan_apn);q.apnDisabled=l.computed(function(){return(u.apn_index<b.defaultApnSize||u.ppp_status=="ppp_connected"||u.ppp_status=="ppp_connecting")});q.apnModeDisabled=l.computed(function(){return(u.ppp_status=="ppp_connected"||u.ppp_status=="ppp_connecting"||(!q.profileName()&&q.apnMode()==d.auto))});q.authModes=l.observableArray(c());q.selectedAuthMode=l.observable(q.currAPN().ppp_auth_mode);q.username=l.observable(q.currAPN().ppp_username);q.password=l.observable(q.currAPN().ppp_passtmp);q.ipv6_selectedAuthMode=l.observable(q.currAPN().ipv6_ppp_auth_mode);q.ipv6_username=l.observable(q.currAPN().ipv6_ppp_username);q.ipv6_password=l.observable(q.currAPN().ipv6_ppp_passtmp);q.transAPN=l.observable("apn_ipv4_apn");q.transAuthMode=l.observable("apn_authentication_ipv4");q.transUserName=l.observable("apn_user_name_ipv4");q.transPassword=l.observable("apn_password_ipv4");q.transAPNIPv6=l.observable("apn_ipv6_apn");q.transAuthModeIPv6=l.observable("apn_authentication_ipv6");q.transUserNameIPv6=l.observable("apn_user_name_ipv6");q.transPasswordIPv6=l.observable("apn_password_ipv6");q.ipType=l.observable(q.currAPN().remo_pdp_type);if(q.ipType()=="IP"||q.ipType()=="IPv4"){q.showIPv4=true;q.showIPv6=false;q.transAPN("apn");q.transAuthMode("apn_authentication");q.transUserName("apn_user_name");q.transPassword("apn_password")}else{if(q.ipType()=="IPv6"){q.showIPv4=false;q.showIPv6=true;q.transAPNIPv6("apn");q.transAuthModeIPv6("apn_authentication");q.transUserNameIPv6("apn_user_name");q.transPasswordIPv6("apn_password")}else{if(b.IPV4_AND_V6_SUPPORT&&q.ipType()=="IPv4v6"){q.showIPv4=true;q.showIPv6=true}else{q.showIPv4=true;q.showIPv6=false;q.transAPN("apn");q.transAuthMode("apn_authentication");q.transUserName("apn_user_name");q.transPassword("apn_password")}}}q.wifiDisabled=(u.wifi_cur_state!="1");q.ssid=l.observable(u.SSID1);q.broadcast=l.observable(u.HideSSID);q.hasWifiWep=b.WIFI_WEP_SUPPORT;q.securityModes=l.observableArray(j);q.selectedSecurityMode=l.observable(u.AuthMode);q.WPAKey=l.observable(u.WPAPSK1);q.apnMode_display=l.observable("");q.apnMode_trans=l.computed(function(){if(d.auto==q.apnMode()){q.apnMode_display(f.i18n.prop("apn_auto_apn"));return"apn_auto_apn"}else{q.apnMode_display(f.i18n.prop("apn_manual_apn"));return"apn_manual_apn"}});q.selectedAuthMode_display=l.computed(function(){var v=q.selectedAuthMode();return p(v)});q.ipv6_selectedAuthMode_display=l.computed(function(){var v=q.ipv6_selectedAuthMode();return p(v)});q.showWifiPassword=l.observable(false);q.showWifiPasswordHandler=function(){f("#pwdWepKey").parent().find(".error").hide();f("#pwdWPAKey").parent().find(".error").hide();var v=f("#showWifiPassword:checked");if(v&&v.length==0){q.showWifiPassword(true)}else{q.showWifiPassword(false)}};var r=g.getWifiAdvance();q.adBand=l.observable(r.wifiBand);q.adMode=l.observable(r.mode);q.encryptType=l.observable(u.EncrypType);q.keyID=l.observable(u.DefaultKeyID);q.wepPassword=l.observable("");q.getWepPassword=function(){return q.keyID()=="3"?u.Key4Str1:(q.keyID()=="2"?u.Key3Str1:q.keyID()=="1"?u.Key2Str1:u.Key1Str1)};q.wepPassword(q.getWepPassword());q.profileChangeHandler=function(w,v){f("#pwdWepKey").parent().find("label[class='error']").hide();q.wepPassword(q.getWepPassword());return true};function p(w){for(var v=0;v<b.APN_AUTH_MODES.length;v++){if(w==b.APN_AUTH_MODES[v].value){return b.APN_AUTH_MODES[v].name}}}q.broadcast_display=l.observable("");q.broadcast_trans=l.computed(function(){if("0"==q.broadcast()){q.broadcast_display(f.i18n.prop("enable"));return"enable"}else{q.broadcast_display(f.i18n.prop("disable"));return"disable"}});q.selectedSecurityMode_display=l.observable();q.selectedSecurityMode_trans=l.computed(function(){var x=q.selectedSecurityMode();var w=b.WIFI_WEP_SUPPORT?b.AUTH_MODES_WEP:b.AUTH_MODES;for(var v=0;v<w.length;v++){if(x==w[v].value){q.selectedSecurityMode_display(f.i18n.prop("security_mode_"+w[v].value));return"security_mode_"+w[v].value}}});function n(){showLoading();var v={apnMode:q.apnMode(),Profile_Name:q.profileName(),APN_name:q.apn(),ppp_auth_mode:q.selectedAuthMode(),ppp_username:q.username(),ppp_passwd:q.password(),SSID_name:q.ssid(),SSID_Broadcast:q.broadcast(),Encryption_Mode_hid:q.selectedSecurityMode(),WPA_PreShared_Key:q.WPAKey(),security_shared_mode:"NONE",wep_default_key:0,WPA_ENCRYPTION_hid:q.selectedSecurityMode()=="OPEN"?"NONE":q.selectedSecurityMode()=="WPA2PSK"?1:2};if(q.encryptType()=="WPAPSKWPA2PSK"){v.security_shared_mode="2"}else{if(q.encryptType()=="WEP"){v.security_shared_mode="WEP"}else{v.security_shared_mode="NONE"}}g.setQuickSetting(v,q.callback)}function t(){showLoading();var v=b.IPV4V6_SUPPORT&&q.currAPN().pdp_type=="IPv4v6";var w={apn_index:u.apn_index,pdp_type:q.ipType(),apnMode:q.apnMode(),profile_name:q.profileName(),wan_apn:q.apn(),ppp_auth_mode:q.selectedAuthMode(),ppp_username:q.username(),ppp_passtmp:q.password(),ipv6_wan_apn:v?q.apn():q.ipv6_apn(),ipv6_ppp_auth_mode:v?q.selectedAuthMode():q.ipv6_selectedAuthMode(),ipv6_ppp_username:v?q.username():q.ipv6_username(),ipv6_ppp_passtmp:v?q.password():q.ipv6_password(),SSID_name:q.ssid(),SSID_Broadcast:q.broadcast(),Encryption_Mode_hid:q.selectedSecurityMode(),WPA_PreShared_Key:q.WPAKey(),security_shared_mode:"NONE",wep_default_key:0,WPA_ENCRYPTION_hid:q.selectedSecurityMode()=="OPEN"?"NONE":q.selectedSecurityMode()=="WPA2PSK"?1:2};w.wep_default_key=q.keyID();if(q.encryptType()=="WPAPSKWPA2PSK"){w.security_shared_mode="NONE"}else{if(q.encryptType()=="WEP"||q.selectedSecurityMode()=="SHARED"){w.security_shared_mode="WEP";w.wep_key_1=u.Key1Str1;w.wep_key_2=u.Key2Str1;w.wep_key_3=u.Key3Str1;w.wep_key_4=u.Key4Str1;var x="0";if(q.wepPassword().length=="5"||q.wepPassword().length=="13"){x="1"}else{x="0"}if(q.keyID()=="1"){w.wep_key_2=q.wepPassword();w.WEP2Select=x}else{if(q.keyID()=="2"){w.wep_key_3=q.wepPassword();w.WEP3Select=x}else{if(q.keyID()=="3"){w.wep_key_4=q.wepPassword();w.WEP4Select=x}else{w.wep_key_1=q.wepPassword();w.WEP1Select=x}}}}else{w.security_shared_mode="NONE"}}g.setQuickSetting4IPv6(w,q.callback)}q.callback=function(v){if(v.result=="success"){successOverlay();location.hash="#net_select"}else{errorOverlay()}};q.save=function(){var w=function(){t()};var v=s();if(v==m.wps_on){showAlert("wps_on_info")}else{if(v==m.wifi_off){showConfirm("quick_setting_wifi_disable_confirm",w)}else{showConfirm("quick_setting_param_changed_confirm",w)}}};q.next=function(){var v=q.currentStep();var w=q.currentStep()+1;o(w);if(v==1&&q.apnMode()==d.auto){w=q.currentStep()+1;o(w)}};q.previous=function(){var v=q.currentStep();var w=q.currentStep()-1;o(w);if(v==3&&q.apnMode()==d.auto){w=q.currentStep()-1;o(w)}};function o(v){if(v<e){v=e}else{if(v>a){v=a}}q.currentStep(v);return true}function s(){var v=g.getWpsInfo();if(v.wpsFlag=="1"){return m.wps_on}else{if(v.radioFlag=="0"){return m.wifi_off}}return m.ok}}function k(){var n=f("#container");l.cleanNode(n[0]);var o=new h();l.applyBindings(o,n[0]);f("#quickSettingForm").validate({submitHandler:function(){if(o.currentStep()<5){o.next()}else{o.save()}},rules:{txtAPN:"apn_check",txtIPv6APN:"apn_check",txtSSID:"ssid",pwdWepKey:{wifi_wep_password_check:true,wifi_password_check:true},txtWepKey:{wifi_wep_password_check:true,wifi_password_check:true},txtWPAKey:"wifi_password_check",pwdWPAKey:"wifi_password_check",txtUserName:"ppp_username_check",txtIPv6UserName:"ppp_username_check",txtPassword:"ppp_password_check",txtIPv6Password:"ppp_password_check"},errorPlacement:function(p,q){var r=q.attr("id");if(r=="txtWPAKey"||r=="pwdWPAKey"){p.insertAfter("#lblShowWifiPassword")}else{if(r=="pwdWepKey"||r=="txtWepKey"){p.insertAfter("#lblShowWepPassword")}else{p.insertAfter(q)}}}})}return{init:k}});