define(["jquery","knockout","config/config","service","underscore"],function(g,m,b,h,j){var e=false;function l(){var n=this;n.hasMultiSSID=b.HAS_MULTI_SSID;n.hasAPStation=b.AP_STATION_SUPPORT;n.hasWifiSwitch=b.WIFI_SWITCH_SUPPORT;n.hasWlanMacfilter=b.HAS_BLACK_AND_WHITE_FILTER;var p=f();n.origin_ap_station_enable=p.ap_station_enable;n.wpsType=m.observable("");n.wpsPin=m.observable("");n.wpsFlag=m.observable(p.wpsFlag);n.authMode=m.observable(p.authMode);n.radioFlag=m.observable(p.radioFlag);n.encrypType=m.observable(p.encrypType);n.mulOption=m.observable(c(p));n.wpsSSID=m.observable(a(p));var o=h.getWifiBasic();n.wifi_enable=m.observable(o.wifi_enable);n.isShowSSIDInfoDiv=m.observable(false);if(b.WIFI_SWITCH_SUPPORT){if(o.wifi_enable=="1"){n.isShowSSIDInfoDiv(true)}else{n.isShowSSIDInfoDiv(false)}}else{n.isShowSSIDInfoDiv(true)}n.multi_ssid_enable=m.observable(o.multi_ssid_enable);n.origin_multi_ssid_enable=o.multi_ssid_enable;n.save=function(){var u=f();if(u.radioFlag=="0"){showAlert("wps_wifi_off");return}if(u.wpsFlag=="1"){showAlert("wps_on_info");return true}if(n.wpsSSID()=="SSID1"){var s=(u.AuthMode=="OPEN"&&u.encrypType=="WEP")||(u.AuthMode=="SHARED"&&u.encrypType=="WEP")||(u.AuthMode=="WPAPSK"&&u.encrypType=="TKIP")||(u.AuthMode=="WPAPSK"&&u.encrypType=="AES")||(u.AuthMode=="WPAPSK"&&u.encrypType=="TKIPCCMP")||(u.AuthMode=="WPA2PSK"&&u.encrypType=="TKIP")||(u.AuthMode=="WPAPSKWPA2PSK"&&u.encrypType=="TKIP")||(u.AuthMode=="WPA3Personal")||(u.AuthMode=="WPA2WPA3");if(s){showAlert("wps_auth_open");return}}else{var w=(u.m_AuthMode=="OPEN"&&u.m_encrypType=="WEP")||(u.m_AuthMode=="SHARED"&&u.m_encrypType=="WEP")||(u.m_AuthMode=="WPAPSK"&&u.m_encrypType=="TKIP")||(u.m_AuthMode=="WPAPSK"&&u.m_encrypType=="AES")||(u.m_AuthMode=="WPAPSK"&&u.m_encrypType=="TKIPCCMP")||(u.m_AuthMode=="WPA2PSK"&&u.m_encrypType=="TKIP")||(u.m_AuthMode=="WPAPSKWPA2PSK"&&u.m_encrypType=="TKIP")||(u.m_AuthMode=="WPA3Personal")||(u.m_AuthMode=="WPA2WPA3");if(w){showAlert("wps_auth_open");return}}var t;var r;if(n.wpsSSID()=="SSID1"){t=u.ssid;r=1}else{t=u.multiSSID;r=2}var q=h.getWifiBasic();if(t==q.SSID&&r==1){if(q.broadcast=="1"){showAlert("wps_ssid_broadcast_disable");return}}else{if(t==q.m_SSID&&r==2){if(q.m_broadcast=="1"){showAlert("wps_ssid_broadcast_disable");return}}}showLoading("waiting");var v={};v.wpsType=n.wpsType();v.wpsPin=d(n.wpsPin());v.wpsSSID=t;v.wpsIndex=r;h.openWps(v,function(x){if(x.result=="success"){n.wpsPin("");clearValidateMsg();successOverlay()}else{errorOverlay()}})};if(p.wpsFlag!="0"){n.wpsType(p.wpsType=="PIN"?"PIN":"PBC")}else{n.wpsType("")}n.setMultiSSIDSwitch=function(){if(n.checkSettings("switch")){return}var q=function(){showLoading("waiting");var s={};s.m_ssid_enable=n.multi_ssid_enable();if(b.WIFI_SWITCH_SUPPORT){s.wifiEnabled=n.wifi_enable()}h.setWifiBasicMultiSSIDSwitch(s,function(t){if(t.result=="success"){if(e){setTimeout(function(){successOverlay();setTimeout(function(){window.location.reload()},1000);clearTimer();clearValidateMsg();h.refreshAPStationStatus();k()},15000)}else{addInterval(function(){var u=h.getWifiBasic();if(u.wifi_enable==n.wifi_enable()){successOverlay();clearTimer();clearValidateMsg();h.refreshAPStationStatus();k()}},1000)}}else{errorOverlay()}})};var r=h.getStatusInfo();if(b.HAS_MULTI_SSID&&n.wifi_enable()=="1"){if(n.multi_ssid_enable()=="1"&&b.AP_STATION_SUPPORT&&n.origin_ap_station_enable=="1"){if(r.wifiStatus){showConfirm("multi_ssid_enable_confirm2",function(){q()})}else{showConfirm("multi_ssid_enable_confirm",function(){q()})}}else{if(r.wifiStatus){showConfirm("wifi_disconnect_confirm2",function(){q()})}else{q()}}}else{q()}};n.checkSettings=function(r){var q=f();if(q.wpsFlag=="1"){showAlert("wps_on_info");return true}return false}}function d(n){if(n.length==9){return n.substring(0,4)+n.substring(5)}else{return n}}function f(){return h.getWpsInfo()}function a(n){if(n.ssid==n.multiSSID){if(n.wifi_wps_index=="2"){return"SSID2"}else{return"SSID1"}}else{return n.wpsSSID==n.multiSSID?"SSID2":"SSID1"}}function c(o){var n=[];n.push(new Option(o.ssid,"SSID1"));if(o.ssidEnable=="1"){n.push(new Option(o.multiSSID,"SSID2"))}return n}function i(){h.getParams({nv:"user_ip_addr"},function(n){h.getParams({nv:"station_list"},function(o){e=isWifiConnected(n.user_ip_addr,o.station_list)})})}function k(){var n=g("#container");m.cleanNode(n[0]);var o=new l();m.applyBindings(o,n[0]);addTimeout(function(){i()},600);g("#frmWifiSwitch").validate({submitHandler:function(){o.setMultiSSIDSwitch()}});g("#wpsForm").validate({submitHandler:function(){o.save()},rules:{txtPin:{wps_pin_validator:true}}})}return{init:k}});