define(["underscore","jquery","knockout","config/config","service","jqui"],function(A,f,c,z,C,w){var l=null;var h=false;var p=[0,1,2,5.5,6,6.5,9,11,12,13,18,19.5,24,26,36,39,48,52,54,58.5,65];function x(E){var H=[],D=[];for(var G=0;G<E.length;G++){for(var F=0;F<E[G].length;F++){if(c.utils.arrayIndexOf(H,E[G][F])==-1){H.push(E[G][F]);D.push({index:E[G][F],rate:p[E[G][F]]})}}}D.sort(function(J,I){return J.rate-I.rate});return D}function e(I){var G=[];var F=[0,1,2,3,7];var H=[0,4,6,8,10,12,14,16,18];var E=[0,5,9,11,13,15,17,19,20];switch(I){case"0":G.push(F);break;case"1":G.push(H);break;case"2":G.push(E);break;case"3":G.push(F);G.push(H);break;case"4":G.push(F);G.push(H);G.push(E);break;default:G.push(E);break}var D=x(G);return B(D)}function B(G){var F=[];for(var D=0;D<G.length;D++){var E=G[D].rate==0?"Auto":G[D].rate+" Mbps";F.push(new Option(E,G[D].index))}return F}function b(F){var D=[new Option("Auto","0")];var E=k(F)+"";switch(E){case"1":m(D,2407,11);break;case"3":m(D,2407,11);m(D,2462,2);break;case"7":m(D,2307,13);m(D,2407,11);m(D,2462,2);break;default:m(D,2407,11)}return D}function y(E){for(key in z.countryCode_5g){var D=z.countryCode_5g[key];if(f.inArray(E,D.codes)!=-1){return r(D.channels)}}return[new Option("Auto","0")]}function m(E,H,G){for(var F=1;F<=G;F++){var D=H+F*5+"MHz (Channel "+E.length+")";E.push(new Option(D,E.length+"_"+(H+F*5)))}}function r(E){var G=[new Option("Auto","0")];for(var H=0;H<E.length;H++){var I=E[H];var F=5000+I*5;var D=F+"MHz (Channel "+I+")";G.push(new Option(D,I+"_"+(F)))}return G}function u(){var D=[];if(z.WIFI_HAS_5G){D.push(new Option("2.4GHz","b"));D.push(new Option("5GHz","a"))}else{D.push(new Option("2.4GHz","b"))}return D}function o(D){var E=[];if(D){E.push(new Option("20MHz","0"));E.push(new Option("20MHz/40MHz","1"))}else{E.push(new Option("20MHz","0"))}return E}function k(H){var D=z.countryCode;var G="";for(key in D){var E=D[key];if(f.inArray(H,E)!=-1){G=key;break}}var F=z.countryCodeType[G];return F?F:"0"}function i(F){var D=F?z.countries_5g:z.countries;var E=[];for(key in D){E.push(new Option(D[key],key))}E=A.sortBy(E,function(G){return G.text});return E}function n(){return C.getWifiAdvance()}function g(){return C.getWpsInfo()}function d(F){var E=F=="a"?z.NETWORK_MODES_BAND:z.NETWORK_MODES;if(E.length==1){f("#mode").hide();f("#modeFor5HZ").hide()}else{if(F=="a"){f("#modeFor5HZ").show();f("#mode").hide();f("#modeLabel").attr("for","modeFor5HZ")}else{f("#mode").show();f("#modeFor5HZ").hide()}}var G=[];for(var D=0;D<E.length;D++){G.push(new Option(E[D].name,E[D].value))}return G}function v(G,F){for(var E=0;E<F.length;E++){var D=F[E];if(D.text==G+" Mbps"){return D.value}}return"0"}function s(G,D){for(var F=0;F<D.length;F++){var E=f(D[F]);if(E.val().split("_")[0]==G){return E.val()}}return"0"}function j(){var E=this;E.hasAPStation=z.AP_STATION_SUPPORT;E.hasWifiBand=c.observable(z.WIFI_BAND_SUPPORT);E.hasBandwidth=c.observable(z.WIFI_BANDWIDTH_SUPPORT);E.hasWifiSwitch=z.WIFI_SWITCH_SUPPORT;E.hasMultiSSID=z.HAS_MULTI_SSID;E.hasWlanMacfilter=z.HAS_BLACK_AND_WHITE_FILTER;var F=C.getWifiAdvance();E.origin_ap_station_enable=F.ap_station_enable;E.modes=c.observableArray(d(F.wifiBand));E.bands=c.observableArray(u());var D=i(F.wifiBand=="a");E.countries=c.observableArray(D);E.channels=c.observableArray(F.wifiBand=="a"?y(F.countryCode):b(F.countryCode));E.rates=c.observableArray(e(F.mode));E.selectedBand=c.observable(F.wifiBand);E.selectedChannelBandwidth=c.observable(F.bandwidth);E.selectedMode=c.observable(F.mode);E.selectedCountry=c.observable(F.countryCode.toUpperCase());E.selectedChannel=c.observable(s(F.channel,E.channels()));E.selectedRate=c.observable(v(F.rate,E.rates()));var G=C.getWifiBasic();E.wifi_enable=c.observable(G.wifi_enable);if((G.AuthMode=="OPEN"&&G.encryptType=="WEP")||(G.AuthMode=="SHARED"&&G.encryptType=="WEP")||G.encryptType=="TKIP"){E.isF=c.observable(true)}else{if(z.HAS_MULTI_SSID&&((G.m_AuthMode=="OPEN"&&G.m_encryptType=="WEP")||(G.m_AuthMode=="SHARED"&&G.m_encryptType=="WEP")||G.m_encryptType=="TKIP")){E.isF=c.observable(true)}else{E.isF=c.observable(false)}}E.isShowSSIDInfoDiv=c.observable(false);if(z.WIFI_SWITCH_SUPPORT){if(G.wifi_enable=="1"){E.isShowSSIDInfoDiv(true)}else{E.isShowSSIDInfoDiv(false)}}else{E.isShowSSIDInfoDiv(true)}E.multi_ssid_enable=c.observable(G.multi_ssid_enable);E.origin_multi_ssid_enable=G.multi_ssid_enable;E.maxStationNumber=c.observable(F.MAX_Station_num);E.selectedStation=c.observable(F.MAX_Access_num);E.selectedStationM=c.observable(F.m_MAX_Access_num);E.oneBandTrans=c.observable(F.wifiBand=="a"?"5G":"2.4G");E.oneModeTrans=c.observable((F.wifiBand=="a"?"network_modes_band_select_":"network_mode_select_")+F.mode);E.channelBandwidths=c.computed(function(){if(z.WIFI_BANDWIDTH_SUPPORT_40MHZ){return o(true)}else{return o(false)}});F=f.extend(F,E);E.bandChangeHandler=function(){if(E.selectedBand()=="a"){E.modes(d(E.selectedBand()));E.countries(i(true))}else{E.modes(d(E.selectedBand()));E.countries(i(false))}E.selectedCountry("0");E.channels(E.generateChannelOption());E.selectedChannel("0")};E.modeChangeHandler=function(J,I){var H=e(E.selectedMode());E.rates(H);E.selectedRate("0")};E.countryChangeHandler=function(J,I){var H=E.generateChannelOption();E.channels(H);E.selectedChannel("0")};E.generateChannelOption=function(){if(E.selectedBand()=="a"){return y(E.selectedCountry())}else{return b(E.selectedCountry())}};E.save=function(){var H=g();if(H.wpsFlag=="1"){showAlert("wps_on_info");return}var J=f("#rate option:selected").text();var L=null;if(J==f.i18n.prop("rate_0")){L=0}else{L=f.trim(J.replace("Mbps",""))}var K={};K.mode=E.selectedMode();K.countryCode=E.selectedCountry();var I=E.selectedChannel();K.channel=I=="0"?"0":I.split("_")[0];K.rate=L;K.wifiBand=E.selectedBand();if(z.WIFI_BANDWIDTH_SUPPORT){K.bandwidth=E.selectedChannelBandwidth()}K.station=E.selectedStation();K.m_station=E.selectedStationM();showConfirm("wifi_disconnect_confirm",function(){showLoading("waiting");C.setWifiAdvance(K,function(M){if(M.result=="success"){if(h){setTimeout(function(){successOverlay();setTimeout(function(){window.location.reload()},1000)},15000)}else{addInterval(function(){var N=C.getWifiBasic();if(N.wifi_enable=="1"){successOverlay();clearTimer();clearValidateMsg();q()}},1000)}}else{errorOverlay()}})})};E.setMultiSSIDSwitch=function(){if(E.checkSettings("switch")){return}var H=function(){showLoading("waiting");var J={};J.m_ssid_enable=E.multi_ssid_enable();if(z.WIFI_SWITCH_SUPPORT){J.wifiEnabled=E.wifi_enable()}C.setWifiBasicMultiSSIDSwitch(J,function(K){if(K.result=="success"){if(h){setTimeout(function(){successOverlay();setTimeout(function(){window.location.reload()},1000);clearTimer();clearValidateMsg();C.refreshAPStationStatus();q()},15000)}else{addInterval(function(){var L=C.getWifiBasic();if(L.wifi_enable==E.wifi_enable()){successOverlay();clearTimer();clearValidateMsg();C.refreshAPStationStatus();q()}},1000)}}else{errorOverlay()}})};var I=C.getStatusInfo();if(z.HAS_MULTI_SSID&&E.wifi_enable()=="1"){if(E.multi_ssid_enable()=="1"&&z.AP_STATION_SUPPORT&&E.origin_ap_station_enable=="1"){if(I.wifiStatus){showConfirm("multi_ssid_enable_confirm2",function(){H()})}else{showConfirm("multi_ssid_enable_confirm",function(){H()})}}else{if(I.wifiStatus){showConfirm("wifi_disconnect_confirm2",function(){H()})}else{H()}}}else{H()}};E.checkSettings=function(I){var H=g();if(H.wpsFlag=="1"){showAlert("wps_on_info");return true}if(z.HAS_MULTI_SSID&&G.multi_ssid_enable=="1"){if((I=="ssid1"&&parseInt(E.selectedStation())+parseInt(G.m_MAX_Access_num)>G.MAX_Station_num)||(I=="ssid2"&&parseInt(E.m_selectedStation())+parseInt(G.MAX_Access_num)>G.MAX_Station_num)){showAlert({msg:"multi_ssid_max_access_number_alert",params:G.MAX_Station_num});return true}}return false}}function a(){C.getParams({nv:"user_ip_addr"},function(D){C.getParams({nv:"station_list"},function(E){h=isWifiConnected(D.user_ip_addr,E.station_list)})})}var t=null;function q(){var D=f("#container");c.cleanNode(D[0]);t=new j();c.applyBindings(t,D[0]);addTimeout(function(){a()},600);function F(){var G=C.getAPStationBasic();if(G.ap_station_enable=="1"){f(":input","#wifi_advance_form").each(function(){f(this).prop("disabled",true)})}else{f(":input","#wifi_advance_form").each(function(){f(this).prop("disabled",false)})}}function E(){var G=C.getWdsInfo();if(G.currentMode!="0"){f(":input","#frmWifiSwitch,#wifi_advance_form").each(function(){f(this).prop("disabled",true)})}else{f(":input","#frmWifiSwitch,#wifi_advance_form").each(function(){f(this).prop("disabled",false)})}}if(z.AP_STATION_SUPPORT){F()}else{if(z.WDS_SUPPORT){E()}}f("#frmWifiSwitch").validate({submitHandler:function(){t.setMultiSSIDSwitch()}});f("#wifi_advance_form").validate({submitHandler:function(){t.save()}})}return{init:q}});