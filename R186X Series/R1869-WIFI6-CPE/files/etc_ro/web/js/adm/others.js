define(["jquery","knockout","config/config","service","underscore"],function(o,h,C,F,D){var q=D.map(C.sntpTimeSetMode,function(G){return new Option(G.name,G.value)});var t=D.map(C.REMO_SELECTSIM_NUM_ID0,function(G){return new Option(G.name,G.value)});var s=D.map(C.REMO_SELECTSIM_NUM_ID1,function(G){return new Option(G.name,G.value)});var r=D.map(C.REMO_SELECTSIM_NUM_ID2,function(G){return new Option(G.name,G.value)});var p=D.map(C.REMO_SELECTSIM_NUM_ID3,function(G){return new Option(G.name,G.value)});var k=D.map(C.REMO_SELECTALLSIM_NUM_ID0,function(G){return new Option(G.name,G.value)});var i=D.map(C.REMO_SELECTALLSIM_NUM_ID1,function(G){return new Option(G.name,G.value)});var e=D.map(C.REMO_SELECTALLSIM_NUM_ID2,function(G){return new Option(G.name,G.value)});var d=D.map(C.REMO_SELECTALLSIM_NUM_ID3,function(G){return new Option(G.name,G.value)});var l=D.map(C.REMO_SELECTSLOTESIM_NUM_ID0,function(G){return new Option(G.name,G.value)});var j=D.map(C.REMO_SELECTSLOTESIM_NUM_ID1,function(G){return new Option(G.name,G.value)});var f=D.map(C.REMO_SELECTSLOTESIM_NUM_ID2,function(G){return new Option(G.name,G.value)});var c=D.map(C.REMO_SELECTSLOTESIM_NUM_ID3,function(G){return new Option(G.name,G.value)});var n=D.map(C.REMO_SELECTSIM_MODE,function(G){return new Option(G.name,G.value)});var m=D.map(C.REMO_SETSIM_SIM_TYPE,function(G){return new Option(G.name,G.value)});var u=D.map(C.timeZone,function(G){return new Option(G.name,G.value)});var x=D.map(C.daylightSave,function(G){return new Option(G.name,G.value)});var E=[];var w=[];var y=[];var g=[];var b=[];var v=[1,3,5,7,8,10,12];var B=[4,6,9,11];function a(K,G,J){var I={};for(var H=K;H<=G;H++){I.name=H;I.value=H;J.push(new Option(I.name,I.value))}}a(2000,2030,E);a(1,12,w);a(0,23,g);a(0,59,b);function z(){var U=this;U.fastbootSupport=C.FAST_BOOT_SUPPORT;U.turnOffSupport=C.TURN_OFF_SUPPORT;U.hasUssd=C.HAS_USSD;U.SNTPSupport=C.HAS_SNTP;U.hasUpdateCheck=C.HAS_UPDATE_CHECK;U.hasDdns=C.DDNS_SUPPORT;U.remo_uicc_sim_temp=F.getSimOptionID().remo_uicc_sim;U.sim_select_display_type=F.getsimselectdisplaytype().remo_sim_select_display_type;U.remo_uicc_sim=0;U.remo_uicc_sim_all=0;if(F.getuicchwid().remo_uicc_hwid=="0"){U.remo_uicc_sim_all="SIM0"}else{if(F.getuicchwid().remo_uicc_hwid=="1"){if(U.sim_select_display_type=="2"||U.sim_select_display_type=="4"){if(U.remo_uicc_sim_temp=="1"){U.remo_uicc_sim_all="SIM2"}else{if(U.remo_uicc_sim_temp=="2"){U.remo_uicc_sim_all="SIM1"}}}else{if(U.remo_uicc_sim_temp=="1"){U.remo_uicc_sim_all="SIM0"}else{if(U.remo_uicc_sim_temp=="2"){U.remo_uicc_sim_all="SIM1"}}}}else{if(F.getuicchwid().remo_uicc_hwid=="2"){if(U.sim_select_display_type=="2"||U.sim_select_display_type=="4"){if(U.remo_uicc_sim_temp=="1"){U.remo_uicc_sim_all="SIM3"}else{if(U.remo_uicc_sim_temp=="2"){U.remo_uicc_sim_all="SIM1"}else{if(U.remo_uicc_sim_temp=="3"){U.remo_uicc_sim_all="SIM1"}else{if(U.remo_uicc_sim_temp=="4"){U.remo_uicc_sim_all="SIM2"}}}}}else{if(U.remo_uicc_sim_temp=="1"){U.remo_uicc_sim_all="SIM0"}else{if(U.remo_uicc_sim_temp=="2"){U.remo_uicc_sim_all="SIM1"}else{if(U.remo_uicc_sim_temp=="3"){U.remo_uicc_sim="SIM1";U.remo_uicc_sim_all="SIM1"}else{if(U.remo_uicc_sim_temp=="4"){U.remo_uicc_sim="SIM2";U.remo_uicc_sim_all="SIM2"}}}}}}else{if(F.getuicchwid().remo_uicc_hwid=="3"){if(U.sim_select_display_type=="2"||U.sim_select_display_type=="4"){if(U.remo_uicc_sim_temp=="1"){U.remo_uicc_sim_all="SIM4"}else{if(U.remo_uicc_sim_temp=="2"){U.remo_uicc_sim_all="SIM1"}else{if(U.remo_uicc_sim_temp=="3"){U.remo_uicc_sim_all="SIM2"}else{if(U.remo_uicc_sim_temp=="4"){U.remo_uicc_sim_all="SIM3"}}}}}else{if(U.remo_uicc_sim_temp=="1"){U.remo_uicc_sim_all="SIM0"}else{if(U.remo_uicc_sim_temp=="2"){U.remo_uicc_sim="SIM1";U.remo_uicc_sim_all="SIM1"}else{if(U.remo_uicc_sim_temp=="3"){U.remo_uicc_sim="SIM2";U.remo_uicc_sim_all="SIM2"}else{if(U.remo_uicc_sim_temp=="4"){U.remo_uicc_sim="SIM3";U.remo_uicc_sim_all="SIM3"}}}}}}}}}U.remo_uicc_hwid=F.getuicchwid().remo_uicc_hwid;U.uicc_switch_mode=F.getSimswitchmode().remo_uicc_switch_mode=="0"?"auto":"manual";U.uicc_switch_mode_all=F.getSimswitchmode().remo_uicc_switch_mode=="0"?"auto":"manual";U.RemoSelectSimMode=h.observableArray(n);U.RemoSelectSimModeAll=h.observableArray(n);U.uicc_sim_type=F.getSimType().uicc_sim_type;U.RemoSetSimType=h.observableArray(m);U.isShowSIMSelect=h.observable(true);U.isShowSIMTypeSelect=h.observable(true);U.isShowAllSIMSelect=h.observable(true);U.isShowAllSIMSelectWithPassword=h.observable(true);T();U.RemoIsShowSimSelect=function(){T()};N();U.RemoIsShowSimTypeSelect=function(){N()};H();U.RemoIsShowAllSimSelect=function(){H()};I();U.RemoIsShowAllSIMSelectWithPassword=function(){I()};U.SelectSimNUM=0;U.SelectSimNUMAll=0;if(U.remo_uicc_hwid=="0"){U.SelectSimNUM=h.observableArray(t);if(U.sim_select_display_type=="2"||U.sim_select_display_type=="4"){U.SelectSimNUMAll=h.observableArray(l)}else{U.SelectSimNUMAll=h.observableArray(k)}}else{if(U.remo_uicc_hwid=="1"){U.SelectSimNUM=h.observableArray(s);if(U.sim_select_display_type=="2"||U.sim_select_display_type=="4"){U.SelectSimNUMAll=h.observableArray(j)}else{U.SelectSimNUMAll=h.observableArray(i)}}else{if(U.remo_uicc_hwid=="2"){U.SelectSimNUM=h.observableArray(r);if(U.sim_select_display_type=="2"||U.sim_select_display_type=="4"){U.SelectSimNUMAll=h.observableArray(f)}else{U.SelectSimNUMAll=h.observableArray(e)}}else{if(U.remo_uicc_hwid=="3"){U.SelectSimNUM=h.observableArray(p);if(U.sim_select_display_type=="2"||U.sim_select_display_type=="4"){U.SelectSimNUMAll=h.observableArray(c)}else{U.SelectSimNUMAll=h.observableArray(d)}}}}}var S=false;if(C.HAS_PARENTAL_CONTROL){S=F.checkCurrentUserInChildGroup().result}U.currentUserInChildGroup=h.observable(S);var M=F.getFastbootSetting();U.fastbootEnableFlag=h.observable(C.RJ45_SUPPORT?(M.need_sim_pin!="yes"&&F.getRj45PlugState().rj45_plug=="wan_lan_off"):M.need_sim_pin!="yes");U.fastbootSetting=h.observable(M.fastbootEnabled);U.atsend_str=h.observable("");U.urlip_str=h.observable("");U.sendAT=function(){var X=U.atsend_str();console.log("sendAT enter"+X.toString());var W={at_str_data:X.toString()};F.SendAT(W,function(Y){console.log("sendAT enter"+Y.result);var Z=document.getElementById("debugData");Z.innerHTML=Y.result})};var J;U.ping_start=function(){var W=U.urlip_str();console.log("ping_start enter"+W);var X={ping_diag_addr:W.toString(),ping_times:100};F.StartPing(X,function(Y){console.log("ping_start enter"+Y.result);if(Y.result=="success"){var Z=document.getElementById("debugData");Z.innerHTML="ping "+W.toString()+" starting...";J=setTimeout(function(){var aa=null;aa=F.StopPing();var ab=document.getElementById("debugData");ab.innerHTML=aa.result.replace(/_/g,"\n");console.log("ping_stop 123 enter"+aa.result)},10000)}else{var Z=document.getElementById("debugData");Z.innerHTML=Y.result}})};U.ping_stop=function(){clearTimeout(J);var W=null;W=F.StopPing();var X=document.getElementById("debugData");X.innerHTML=W.result.replace(/_/g,"\n");console.log("ping_stop 123 enter"+W.result)};function V(){return F.getSimOptionID()}function O(){return F.getSimswitchmode()}U.admin_password_str=h.observable("");U.SimSelect=function(){var W={sim_option_id:document.getElementById("sim_option_id").value,select_sim_mode:document.getElementById("sim_select_mode_id").value};F.SimSelect(W,function(X){if(X.result=="success"){successOverlay()}else{if(X.result=="Parameter_not_modified"){showOverLay("Parameter_not_modified","overlay-error")}else{if(X.result=="Please_retry"){showOverLay("Please_retry","overlay-error")}else{if(X.result=="Try_too_much"){showOverLay("try_too_much","overlay-error")}else{errorOverlay()}}}}})};U.admin_password_str=h.observable("");U.SimSelectAll=function(){var W={sim_option_id_all:document.getElementById("sim_option_id_all").value,select_sim_mode_all:"manual"};F.SimSelectAll(W,function(X){if(X.result=="success"){successOverlay()}else{if(X.result=="Parameter_not_modified"){showOverLay("Parameter_not_modified","overlay-error")}else{if(X.result=="Please_retry"){showOverLay("Please_retry","overlay-error")}else{if(X.result=="Try_too_much"){showOverLay("try_too_much","overlay-error")}else{errorOverlay()}}}}})};U.sim_select_password=h.observable("");U.AllSimSelectWithPassword=function(){var Y=U.sim_select_password();var W=U.sim_id;var X={sim_option_id_all:document.getElementById("sim_id_with_password").value,select_sim_mode_all:"manual",admin_password:Y.toString()};F.SimSelectAll(X,function(Z){if(Z.result=="success"){successOverlay()}else{if(Z.result=="Parameter_not_modified"){showOverLay("Parameter_not_modified","overlay-error")}else{if(Z.result=="Please_retry"){showOverLay("Please_retry","overlay-error")}else{if(Z.result=="admin_password_error"){showOverLay("admin_password_error","overlay-error")}else{if(Z.result=="Try_too_much"){showOverLay("try_too_much","overlay-error")}else{errorOverlay()}}}}}})};U.admin_password_str=h.observable("");U.simtypeselect=function(){var Y=U.admin_password_str();var W=U.sim_id;var X={remo_sim_type:document.getElementById("remo_sim_type").value,admin_password:Y.toString()};showConfirm("restart_confirm",function(){F.simtypeselect(X,function(Z){if(Z.result=="success"){successOverlay()}else{if(Z.result=="Parameter_not_modified"){showOverLay("Parameter_not_modified","overlay-error")}else{if(Z.result=="admin_password_error"){showOverLay("admin_password_error","overlay-error")}else{if(Z.result=="Try_too_much"){showOverLay("try_too_much","overlay-error")}else{errorOverlay()}}}}})})};function H(){if(F.getsimselectdisplaytype().remo_sim_select_display_type=="1"||F.getsimselectdisplaytype().remo_sim_select_display_type=="2"){if(F.getuicchwid().remo_uicc_hwid=="0"){U.isShowAllSIMSelect(false)}else{U.isShowAllSIMSelect(true)}}else{U.isShowAllSIMSelect(false)}return true}function I(){if(F.getsimselectdisplaytype().remo_sim_select_display_type=="3"||F.getsimselectdisplaytype().remo_sim_select_display_type=="4"){if(F.getuicchwid().remo_uicc_hwid=="0"){U.isShowAllSIMSelectWithPassword(false)}else{U.isShowAllSIMSelectWithPassword(true)}}else{U.isShowAllSIMSelectWithPassword(false)}return true}function T(){if(F.getuicchwid().remo_uicc_hwid=="0"||F.getuicchwid().remo_uicc_hwid=="1"||F.getSimOptionID().remo_uicc_sim=="1"){U.isShowSIMSelect(false)}else{if(F.getautoswitchmode().auto_switch_mode!="0"&&F.getautoswitchmode().auto_switch_mode!="1"){U.isShowSIMSelect(false)}else{if(F.getsimselectdisplaytype().remo_sim_select_display_type=="0"){U.isShowSIMSelect(true)}else{U.isShowSIMSelect(false)}}}return true}function N(){if(F.getsimselectdisplaytype().remo_sim_select_display_type=="0"&&(F.getuicchwid().remo_uicc_hwid=="1"||F.getuicchwid().remo_uicc_hwid=="2"||F.getuicchwid().remo_uicc_hwid=="3")){if(F.getautoswitchmode().auto_switch_mode!="0"&&F.getautoswitchmode().auto_switch_mode!="1"){U.isShowSIMTypeSelect(false)}else{U.isShowSIMTypeSelect(true)}}else{U.isShowSIMTypeSelect(false)}return true}U.isShowFotaSwitch=h.observable(false);if(F.getfotaswitch().remo_fota_switch=="1"){U.isShowFotaSwitch(true)}else{U.isShowFotaSwitch(false)}U.isShowAtDebugSwitch=h.observable(false);if(F.getAtDebugSwitch().remo_web_at_debug_switch=="1"){U.isShowAtDebugSwitch(true)}else{U.isShowAtDebugSwitch(false)}U.isShowSimSwitch=h.observable(false);if(F.getSimSwitch().remo_web_sim_switch=="1"){U.isShowSimSwitch(true)}else{U.isShowSimSwitch(false)}function Q(){if(U.currentSIMMode()=="manual"){U.isManualSelectSIM(true);U.isAutoSelectSIM(false)}else{U.isManualSelectSIM(false);U.isAutoSelectSIM(true)}return true}U.saveFastBoot=function(){showLoading();var W={fastbootEnabled:U.fastbootSetting(),need_hard_reboot:M.need_hard_reboot};F.setFastbootSetting(W,function(X){if(X.result=="success"){successOverlay()}else{errorOverlay()}})};addInterval(function(){U.fastbootEnableFlag(C.RJ45_SUPPORT?(M.need_sim_pin!="yes"&&F.getRj45PlugState().rj45_plug=="wan_lan_off"):M.need_sim_pin!="yes")},1000);U.restore=function(){showConfirm("restore_confirm",function(){showLoading("restoring");F.restoreFactorySettings({},function(W){if(W&&W.result=="success"){successOverlay()}else{errorOverlay()}},function(W){if(isErrorObject(W)&&W.errorType=="no_auth"){errorOverlay()}})})};U.restart=function(){showConfirm("restart_confirm",function(){restartDevice(F)})};U.turnoff=function(){showConfirm("turnoff_confirm",function(){showLoading("turnoff");F.turnOffDevice({},function(W){if(W&&W.result=="success"){successOverlay()}else{errorOverlay()}},o.noop)})};F.setSNTPDate({goformId:"SNTP_Getdatastatic"});var U=this;var L=F.getSntpParams();globalTime=new Date(parseInt(L.sntp_year,10),parseInt(L.sntp_month,10)-1,parseInt(L.sntp_day,10),parseInt(L.sntp_hour,10),parseInt(L.sntp_minute,10),parseInt(L.sntp_second,10));U.day=h.observable();U.localTime=h.observable();U.updateCurrentTime;U.timeSetModes=h.observableArray(q);U.isManualSetTime=h.observable(false);U.isAutoSntpTime=h.observable(false);U.currentMode=h.observable(L.sntp_time_set_mode);K();U.changeSetTimeMode=function(){K()};U.currentYear=h.observable(parseInt(L.sntp_year,10));U.currentMonth=h.observable(parseInt(L.sntp_month,10));U.currentDate=h.observable(parseInt(L.sntp_day,10));U.currentHour=h.observable(parseInt(L.sntp_hour,10));U.currentMinute=h.observable(parseInt(L.sntp_minute,10));U.years=h.observableArray(E);U.months=h.observableArray(w);U.initDateList=function(){P();U.dates(y)};P();U.dates=h.observableArray(y);U.hours=h.observableArray(g);U.minutes=h.observableArray(b);var R=D.map(L.sntp_servers,function(W){return new Option(W.name,W.value)});U.serverList=h.observableArray(R);U.currentServer0=h.observable(L.sntp_server0);U.currentServer1=h.observable(L.sntp_server1);U.currentServer2=h.observable(L.sntp_server2);U.customServer0=h.observable(L.sntp_other_server0);U.customServer1=h.observable(L.sntp_other_server1);U.customServer2=h.observable(L.sntp_other_server2);U.isOther0=h.observable(false);U.isOther1=h.observable(false);U.isOther2=h.observable(false);G();U.changeServerSelect=function(){G()};U.timeZones=h.observableArray(u);U.currentTimeZone=h.observable(L.sntp_timezone+"_"+L.sntp_timezone_index);U.daylightSaves=h.observableArray(x);U.currentDaylightSave=h.observable(L.sntp_dst_enable);U.updateCurrentTime=function(){var W=globalTime.getDay();switch(W){case 0:U.day(o.i18n.prop("sunday"));break;case 1:U.day(o.i18n.prop("monday"));break;case 2:U.day(o.i18n.prop("tuesday"));break;case 3:U.day(o.i18n.prop("wednesday"));break;case 4:U.day(o.i18n.prop("thursday"));break;case 5:U.day(o.i18n.prop("friday"));break;case 6:U.day(o.i18n.prop("saturday"));break;default:break}var X=globalTime.getFullYear()+"-"+getTwoDigit(globalTime.getMonth()+1)+"-"+getTwoDigit(globalTime.getDate())+" "+getTwoDigit(globalTime.getHours())+":"+getTwoDigit(globalTime.getMinutes())+":"+getTwoDigit(globalTime.getSeconds());U.localTime(X);globalTime.setTime(globalTime.getTime()+1000)};U.apply=function(){var X=[];for(var W=0;W<L.sntp_servers.length;W++){X.push(L.sntp_servers[W].value)}var Z=F.getStatusInfo();if(!checkConnectedStatus(Z.connectStatus,Z.rj45ConnectStatus,Z.connectWifiStatus)&&U.currentMode()=="auto"){showAlert("sntp_syn_time_wan_connected");return}showLoading("");var Y={goformId:"SNTP",manualsettime:U.currentMode(),sntp_server1_ip:U.currentServer0(),sntp_server2_ip:U.currentServer1(),sntp_server3_ip:U.currentServer2(),sntp_other_server0:U.customServer0(),sntp_other_server1:U.customServer1(),sntp_other_server2:U.customServer2(),timezone:U.currentTimeZone().split("_")[0],sntp_timezone_index:U.currentTimeZone().split("_")[1],DaylightEnabled:U.currentDaylightSave(),time_year:U.currentYear(),time_month:U.currentMonth(),time_day:U.currentDate(),time_hour:U.currentHour(),time_minute:U.currentMinute()};F.setSntpSetting(Y,function(aa){if(aa){if(aa.result=="success"&&U.currentMode()=="auto"){successOverlay("sntp_req_success")}else{if(aa.result=="processing"&&U.currentMode()=="auto"){successOverlay("sntp_processing")}else{F.setSNTPDate({goformId:"SNTP_Getdatastatic"},function(ab){var ac=F.getSntpParams();globalTime=new Date(parseInt(ac.sntp_year,10),parseInt(ac.sntp_month,10)-1,parseInt(ac.sntp_day,10),parseInt(ac.sntp_hour,10),parseInt(ac.sntp_minute,10),parseInt(ac.sntp_second,10));successOverlay()})}}}else{errorOverlay()}})};function P(){y=[];if(o.inArray(parseInt(U.currentMonth(),10),v)!=-1){a(1,31,y)}else{if(o.inArray(parseInt(U.currentMonth(),10),B)!=-1){a(1,30,y)}else{if(parseInt(U.currentYear(),10)%4==0){a(1,29,y)}else{a(1,28,y)}}}}function G(){U.isOther0(U.currentServer0()=="Other");U.isOther1(U.currentServer1()=="Other");U.isOther2(U.currentServer2()=="Other");!U.isOther0()&&o("#sntp_server0").find(".error").hide();!U.isOther1()&&o("#sntp_server1").find(".error").hide();!U.isOther2()&&o("#sntp_server2").find(".error").hide()}function K(){if(U.currentMode()=="manual"){U.isManualSetTime(true);U.isAutoSntpTime(false)}else{U.isManualSetTime(false);U.isAutoSntpTime(true)}return true}}function A(){var H=new z();var G=o("#container")[0];h.cleanNode(G);h.applyBindings(H,G);H.updateCurrentTime();addInterval(function(){H.updateCurrentTime()},1000);o("#sntpForm").validate({submitHandler:function(){H.apply()},rules:{sntp_other_server0:"sntp_invalid_server_name",sntp_other_server1:"sntp_invalid_server_name",sntp_other_server2:"sntp_invalid_server_name"}})}return{init:A}});