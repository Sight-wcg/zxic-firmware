define(["underscore","jquery","knockout","config/config","service"],function(g,c,i,a,e){var b=false;function d(){var j=this;var l=e.getMacFilterInfo();var k=e.getWifiBasic();j.multi_ssid_enable=i.observable(k.multi_ssid_enable);j.origin_ap_station_enable=k.ap_station_enable;j.hasWifiSwitch=a.WIFI_SWITCH_SUPPORT;j.hasMultiSSID=a.HAS_MULTI_SSID;j.showIsolated=a.SHOW_WIFI_AP_ISOLATED;j.wifi_enable=i.observable(k.wifi_enable);j.hasAPStation=a.AP_STATION_SUPPORT;j.isShowSSIDInfoDiv=i.observable(false);if(a.WIFI_SWITCH_SUPPORT){if(k.wifi_enable=="1"){j.isShowSSIDInfoDiv(true)}else{j.isShowSSIDInfoDiv(false)}}else{j.isShowSSIDInfoDiv(true)}j.selectedAction=i.observable(l.ACL_mode);j.mac1=i.observable("");j.mac2=i.observable("");j.mac3=i.observable("");j.mac4=i.observable("");j.mac5=i.observable("");j.mac6=i.observable("");j.mac7=i.observable("");j.mac8=i.observable("");j.mac9=i.observable("");j.mac10=i.observable("");if(l.ACL_mode=="1"){macInfoWhite=l.wifi_mac_white_list.split(";");j.mac1=i.observable(macInfoWhite[0]);j.mac2=i.observable(macInfoWhite[1]);j.mac3=i.observable(macInfoWhite[2]);j.mac4=i.observable(macInfoWhite[3]);j.mac5=i.observable(macInfoWhite[4]);j.mac6=i.observable(macInfoWhite[5]);j.mac7=i.observable(macInfoWhite[6]);j.mac8=i.observable(macInfoWhite[7]);j.mac9=i.observable(macInfoWhite[8]);j.mac10=i.observable(macInfoWhite[9])}if(l.ACL_mode=="2"){macInfoBlack=l.wifi_mac_black_list.split(";");j.mac1=i.observable(macInfoBlack[0]);j.mac2=i.observable(macInfoBlack[1]);j.mac3=i.observable(macInfoBlack[2]);j.mac4=i.observable(macInfoBlack[3]);j.mac5=i.observable(macInfoBlack[4]);j.mac6=i.observable(macInfoBlack[5]);j.mac7=i.observable(macInfoBlack[6]);j.mac8=i.observable(macInfoBlack[7]);j.mac9=i.observable(macInfoBlack[8]);j.mac10=i.observable(macInfoBlack[9])}j.save=function(){var m=e.getWpsInfo();if(m.wpsFlag=="1"){showAlert("wps_on_info");return true}if(j.mac1()==undefined||j.mac1().indexOf(" ")>=0){j.mac1("")}if(j.mac2()==undefined||j.mac2().indexOf(" ")>=0){j.mac2("")}if(j.mac3()==undefined||j.mac3().indexOf(" ")>=0){j.mac3("")}if(j.mac4()==undefined||j.mac4().indexOf(" ")>=0){j.mac4("")}if(j.mac5()==undefined||j.mac5().indexOf(" ")>=0){j.mac5("")}if(j.mac6()==undefined||j.mac6().indexOf(" ")>=0){j.mac6("")}if(j.mac7()==undefined||j.mac7().indexOf(" ")>=0){j.mac7("")}if(j.mac8()==undefined||j.mac8().indexOf(" ")>=0){j.mac8("")}if(j.mac9()==undefined||j.mac9().indexOf(" ")>=0){j.mac9("")}if(j.mac10()==undefined||j.mac10().indexOf(" ")>=0){j.mac10("")}var q=new Array(j.mac1(),j.mac2(),j.mac3(),j.mac4(),j.mac5(),j.mac6(),j.mac7(),j.mac8(),j.mac9(),j.mac10());if(j.selectedAction()=="2"&&l.client_mac_address!=""&&c.inArray(l.client_mac_address,q)!=-1){showAlert("black_yourself_tip");return false}var p=q.sort();for(var o=0;o<p.length-1;o++){if(p[o]!=""&&p[o]==p[o+1]){showAlert("mac_repeat_tip");return false}}var n="";for(var o=0;o<10;o++){if(n==""){n=q[o]}else{if(q[o]){n=n+";"+q[o]}}}var r={};r.ACL_mode=j.selectedAction();if(j.selectedAction()=="1"){r.wifi_mac_white_list=n}if(j.selectedAction()=="2"){r.wifi_mac_black_list=n}showLoading("waiting");e.setMacFilter(r,function(s){if(s.result=="success"){successOverlay()}else{errorOverlay()}})};j.ChangeHandler=function(){c("#mac_filter_form").find(".error").hide();c("#mac_filter_form").find("input[type=text]").show();var m=e.getMacFilterInfo();if(j.selectedAction()=="1"){macInfoWhite=m.wifi_mac_white_list.split(";");j.mac1(macInfoWhite[0]);j.mac2(macInfoWhite[1]);j.mac3(macInfoWhite[2]);j.mac4(macInfoWhite[3]);j.mac5(macInfoWhite[4]);j.mac6(macInfoWhite[5]);j.mac7(macInfoWhite[6]);j.mac8(macInfoWhite[7]);j.mac9(macInfoWhite[8]);j.mac10(macInfoWhite[9])}else{if(j.selectedAction()=="2"){macInfoBlack=m.wifi_mac_black_list.split(";");j.mac1(macInfoBlack[0]);j.mac2(macInfoBlack[1]);j.mac3(macInfoBlack[2]);j.mac4(macInfoBlack[3]);j.mac5(macInfoBlack[4]);j.mac6(macInfoBlack[5]);j.mac7(macInfoBlack[6]);j.mac8(macInfoBlack[7]);j.mac9(macInfoBlack[8]);j.mac10(macInfoBlack[9])}else{j.mac1("");j.mac2("");j.mac3("");j.mac4("");j.mac5("");j.mac6("");j.mac7("");j.mac8("");j.mac9("");j.mac10("")}}};j.checkSettings=function(n){var m=e.getWpsInfo();if(m.wpsFlag=="1"){showAlert("wps_on_info");return true}return false};j.setMultiSSIDSwitch=function(){if(j.checkSettings("switch")){return}var m=function(){showLoading("waiting");var o={};o.m_ssid_enable=j.multi_ssid_enable();if(a.WIFI_SWITCH_SUPPORT){o.wifiEnabled=j.wifi_enable()}e.setWifiBasicMultiSSIDSwitch(o,function(p){if(p.result=="success"){if(b){setTimeout(function(){successOverlay();setTimeout(function(){window.location.reload()},1000);clearTimer();clearValidateMsg();e.refreshAPStationStatus();h()},15000)}else{addInterval(function(){var q=e.getWifiBasic();e.refreshAPStationStatus();if(q.wifi_enable==j.wifi_enable()){successOverlay();clearTimer();clearValidateMsg();e.refreshAPStationStatus();h()}},1000)}}else{errorOverlay()}})};var n=e.getStatusInfo();if(a.HAS_MULTI_SSID&&j.wifi_enable()=="1"){if(j.multi_ssid_enable()=="1"&&a.AP_STATION_SUPPORT&&j.origin_ap_station_enable=="1"){if(n.wifiStatus){showConfirm("multi_ssid_enable_confirm2",function(){m()})}else{showConfirm("multi_ssid_enable_confirm",function(){m()})}}else{if(n.wifiStatus){showConfirm("wifi_disconnect_confirm2",function(){m()})}else{m()}}}else{m()}}}function f(){e.getParams({nv:"user_ip_addr"},function(j){e.getParams({nv:"station_list"},function(k){b=isWifiConnected(j.user_ip_addr,k.station_list)})})}function h(){var j=c("#container");i.cleanNode(j[0]);var k=new d();i.applyBindings(k,j[0]);c("#mac_filter_form").validate({submitHandler:function(){if(document.getElementById("country").value=="1"){var m=false;var n=(c(".mac").length);for(var l=0;l<n;l++){if(c(".mac").eq(l).val().length!=0){m=true;break}}if(m==true){k.save()}else{showAlert("white_list_null")}}else{k.save()}},rules:{mac_1:"mac_check",mac_2:"mac_check",mac_3:"mac_check",mac_4:"mac_check",mac_5:"mac_check",mac_6:"mac_check",mac_7:"mac_check",mac_8:"mac_check",mac_9:"mac_check",mac_10:"mac_check"}});c("#frmWifiSwitch").validate({submitHandler:function(){k.setMultiSSIDSwitch()}});addTimeout(function(){f()},600)}return{init:h}});