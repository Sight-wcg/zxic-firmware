define(["jquery","knockout","config/config","service","underscore"],function(f,e,d,a,c){function b(){var h=this;var j=a.getUrlFilterList();var i=[{columnType:"checkbox",rowText:"index",width:"30%"},{headerTextTrans:"url",rowText:"url",width:"70%"}];h.rules=e.observableArray(j.urlFilterRules);h.gridTemplate=new e.simpleGrid.viewModel({data:h.rules(),idName:"index",columns:i,tmplType:"list",pageSize:10});h.clear=function(){f("#addURLFilter").val("")};h.callback=function(k){if(k.result=="success"){h.clear();g(h);successOverlay();f("#urlFilters").translate()}else{errorOverlay()}};h.addRule=function(){if(h.rules().length>=d.urlFilterMax){showAlert({msg:"url_filter_max",params:d.urlFilterMax});return false}var l=[];for(var k=0;k<h.rules().length;k++){l.push(h.rules()[k].url)}if(f.inArray(f("#addURLFilter").val(),l)!=-1){showAlert("url_repeated");return false}showLoading();var m={goformId:"URL_FILTER_ADD",addURLFilter:f("#addURLFilter").val()};a.addUrlFilterRule(m,h.callback)};h.deleteRule=function(){showConfirm("confirm_data_delete",function(){showLoading();var k={goformId:"URL_FILTER_DELETE",url_filter_delete_id:h.gridTemplate.selectedIds().join(";")+";"};a.deleteSelectedRules(k,h.callback)})}}function g(){var h=f("#container");e.cleanNode(h[0]);var i=new b();e.applyBindings(i,h[0]);f("#urlFilterForm").validate({submitHandler:function(){i.addRule()},rules:{addURLFilter:"url_filter_check"}});f("#urlFilterListForm").validate({submitHandler:function(){i.deleteRule()}})}return{init:g}});