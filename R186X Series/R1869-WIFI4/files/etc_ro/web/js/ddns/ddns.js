define(["jquery","knockout","config/config","service","underscore"],function(d,j,b,e,h){var g=h.map(b.DDNSSetMode,function(k){return new Option(k.name,k.value)});var f=h.map(b.DDNSDDP,function(k){return new Option(k.name,k.value)});var c=h.map(b.ddns_Modeselect,function(k){return new Option(k.name,k.value)});function a(){var m=this;m.hasUssd=b.HAS_USSD;m.hasUpdateCheck=b.HAS_UPDATE_CHECK;var o=e.getDdnsParams();m.ddnsSetModes=j.observableArray(g);m.ddnsProviderList=j.observableArray(f);m.ddns_mode_select=j.observableArray(c);m.currentMode=j.observable(o.DDNS_Enable);m.currentModeselect=j.observable(o.DDNS_Mode);m.currentProviderList=j.observable("dyndns.org");d.each(b.DDNSDDP,function(p,q){if(o.DDNSProvider==q.value){m.currentProviderList(o.DDNSProvider)}});m.DDNSaccount=j.observable(o.DDNSAccount);m.DDNSpasswd=j.observable(o.DDNSPassword);m.DDNSname=j.observable(o.DDNS);m.DDNS_HashValue=j.observable(o.DDNS_Hash_Value);m.isddnsStatusTrans=j.observable();m.isEnableSet=j.observable();m.isHashValue=j.observable();m.isddnsaccount=j.observable();m.isddnspasswd=j.observable();m.isDDNSStatus=j.observable();m.isddnsdomainName=j.observable();m.isNone=j.observable();m.onStates=j.observable();m.showPassword_ddns=j.observable(false);m.showPasswordHandler_ddns=function(){d("#ddns_passwd_input").parent().find(".error").hide();var p=d("#showPassword_ddns:checked");if(p&&p.length==0){m.showPassword_ddns(true)}else{m.showPassword_ddns(false)}};l();m.changeDdnsProvider=function(){if(o.DDNSProvider==m.currentProviderList()){m.DDNSaccount(o.DDNSAccount);m.DDNSpasswd(o.DDNSPassword);m.DDNSname(o.DDNS)}else{m.DDNSaccount("");m.DDNSpasswd("");m.DDNSname("")}l()};k();m.changeSetDdnsMode=function(){k()};n();m.apply=function(){showLoading();var p={};p.goformId="DDNS";p.DDNS_Enable=m.currentMode();if(m.currentMode()=="1"){p.DDNS_Mode=m.currentModeselect();p.DDNSProvider=m.currentProviderList();if(m.currentProviderList()!="none"){p.DDNSAccount=m.DDNSaccount();p.DDNSPassword=m.DDNSpasswd();p.DDNS=m.DDNSname()}if(m.currentProviderList()=="freedns.afraid.org"){p.DDNS_Hash_Value=m.DDNS_HashValue()}}e.setDDNSForward(p,function(q){if(q.result=="success"){successOverlay();o=e.getDdnsParams()}else{errorOverlay()}})};function k(){if(m.currentMode()=="1"){m.isEnableSet(true)}else{m.isEnableSet(false)}return true}function n(){var p="";d.getJSON("/reqproc/proc_get",{cmd:"getddns_status",_:new Date().getTime()},function(q){if(q.getddns_status=="0"){p="register successful";m.onStates(true)}else{if(q.getddns_status=="1"){p="login error";m.onStates(true)}else{if(q.getddns_status=="2"){p="network error";m.onStates(true)}else{if(q.getddns_status=="3"){p="registering";m.onStates(true)}else{if(q.getddns_status=="4"){p="not registered";m.onStates(true)}else{if(q.getddns_status=="5"){p="error registering";m.onStates(true)}else{if(q.getddns_status=="-1"){p="";m.onStates(true)}}}}}}}m.isddnsStatusTrans(d.i18n.prop(p));addTimeout(n,2000)})}function l(){if(m.currentProviderList()=="none"){m.isddnsaccount(false);m.isddnspasswd(false);m.isddnsdomainName(false);m.isHashValue(false);m.isDDNSStatus(false)}else{m.isddnsaccount(true);m.isddnspasswd(true);m.isddnsdomainName(true);m.isHashValue(true);m.isDDNSStatus(true)}if(m.currentProviderList()=="freedns.afraid.org"){m.isHashValue(true)}else{m.isHashValue(false)}return true}}function i(){var k=d("#container");j.cleanNode(k[0]);var l=new a();j.applyBindings(l,k[0]);d("#ddnsForm").validate({submitHandler:function(){l.apply()},rules:{ddns_passwd_input:"password_check",DDNS_Hash_Value:"ddns_hashvalue_check",ddns_passwd_inputshow:"password_check"},errorPlacement:function(m,n){var o=n.attr("id");if(o=="ddns_passwd_input"){m.insertAfter("#lblShowPassword")}else{if(o=="ddns_passwd_inputshow"){m.insertAfter("#lblShowPassword")}else{m.insertAfter(n)}}}})}self.isShowFotaSwitch=j.observable(false);if(e.getfotaswitch().remo_fota_switch=="1"){self.isShowFotaSwitch(true)}else{self.isShowFotaSwitch(false)}return{init:i}});