define(["knockout","jquery","underscore","service","config/config","config/menu","tooltip"],function(U,D,ab,d,J,V,H){var W={};var p=false;var z=false;var n=false;var i=false;var C=false;var x=false;var F=null;var b=0;var O=null;var B=null;var T=true;var g=false;function R(){if(J.PRODUCT_TYPE=="DATACARD"){D("#statusBar").addClass("padding-right-90");D("#language").addClass("data-card-language")}var ag=D("<img />").attr("src","pic/confirm.png");var af=D("<img />").attr("src","pic/alert.png");var ai=D("<img />").attr("src","pic/info.png");window.setTimeout(function(){var ak=new K();U.applyBindings(ak,D("#statusBar")[0]);window.setInterval(function(){var ao=u();ak.isShowFotaNewversionIcon(ao.new_version_state&&ao.fota_user_selector&&ao.fota_package_already_download!="yes"&&J.ISNOW_NOTICE&&ak.updateType()=="mifi_fota");ak.isShowRj45ConnectionIcon(J.RJ45_SUPPORT);ak.networkType(getNetworkType(ao.networkType));ak.signalCssClass(X(ao.signalImg,ao.networkType,ao.simStatus));var am=ao.roamingStatus?true:false;ak.networkOperator(o(ao.spn_b1_flag,ao.spn_name_data,ao.spn_b2_flag,ao.networkOperator,am));ak.roamingStatus(ao.roamingStatus?"R":"");ak.wifiStatusImg(S(ao.wifiStatus,ao.wirelessDeviceNum));ak.wifiStatusCssClass(t(ao.wifiStatus,ao.wirelessDeviceNum));ak.simStatus(h(ao.simStatus));ak.batteryPers(aa(ao.batteryPers,ao.batteryStatus));ak.batteryLevel(ao.batteryLevel+"%");ak.pinStatus(ao.pinStatus);ak.batteryStatus(ao.batteryStatus);ak.showAttachedDevices(ao.wifiStatus);ak.isLoggedIn(ao.isLoggedIn);T=ao.isLoggedIn;if(J.HAS_SMS){if(!C&&ao.isLoggedIn){aj(ao.smsUnreadCount)}else{ak.smsUnreadCount(ao.smsUnreadCount)}}s(ak,ao.connectStatus,ao.data_counter,ao.connectWifiSSID,ao.connectWifiStatus,ao.rj45ConnectStatus);ac(ak,ao.connectStatus,ao.connectWifiSSID,ao.connectWifiStatus);checkTrafficLimitAlert(ak,ao);ad({simStatus:ao.simStatus,wifiStatus:ao.wifiStatus,deviceSize:ao.wirelessDeviceNum,networkType:ao.networkType});var an=D("#langLogoBar");if(ao.isLoggedIn){D("#statusBar:hidden").show()}else{D("#statusBar:visible").hide()}},500);if(J.HAS_SMS){window.setInterval(function(){if(ak.isLoggedIn()){aj()}},10000);ah()}window.setInterval(function(){var an=u();var am=["prepare_install","low_battery","download_success","downloading"];if(ak.isLoggedIn()==true&&!(D("#progress").is(":visible"))&&an.defaultWanName!=""){if(D.inArray(an.current_upgrade_state,am)!=-1){if(null==F){if(!an.is_mandatory){D.modal.close()}Q()}else{if(false==F){F=null}}}}},1000);var al=function(){var am=d.getStatusInfo();if(am.isLoggedIn){d.getUpgradeResult({},function(an){if(an.upgrade_result=="success"){I(true)}else{if(an.upgrade_result=="fail"){I(false)}else{window.setTimeout(al,1000)}}},function(){window.setTimeout(al,1000)})}else{window.setTimeout(al,1000)}};if(ak.updateType()=="mifi_fota"){al();window.setInterval(function(){var am=u();if(am.isLoggedIn&&am.defaultWanName!=""){if(am.new_version_state&&am.fota_package_already_download!="yes"&&!J.ALREADY_NOTICE){d.getUpgradeResult({},function(an){if(an.upgrade_result=="success"){I(true)}else{if(an.upgrade_result=="fail"){I(false)}else{if(g==false){J.ALREADY_NOTICE=true;showOTAAlert()}}}})}}},1000)}function aj(am){d.getSmsCapability({},function(an){var ao=false;if(an.nvTotal!=0&&an.nvUsed>=an.nvTotal){D("#sms_unread_count").attr("tipTitle","sms_capacity_is_full");ao=true}else{if(an.nvTotal!=0&&an.nvUsed+5>=an.nvTotal){D("#sms_unread_count").attr("tipTitle","sms_capacity_will_full");ao=true}else{D("#sms_unread_count").attr("tipTitle","sms_unread_count")}}ak.showSmsDeleteConfirm(ao);if(typeof am!="undefined"){ak.smsUnreadCount(am)}C=true})}},1200);H.init();function ah(){var aj=u();if(aj.isLoggedIn){d.getSMSReady({},function(ak){if(ak.sms_cmd_status_result=="1"){window.setTimeout(function(){ah()},1000)}else{i=true}})}else{window.setTimeout(function(){ah()},1000)}}checkTrafficLimitAlert=function(an,ao){if(window.location.hash=="#login"){return false}var aj=J.AP_STATION_SUPPORT?d.getStatusInfo().ap_station_enable:"undefined";if(J.AP_STATION_SUPPORT&&(typeof aj=="undefined"||aj==="")){d.refreshAPStationStatus({},D.noop());return false}aj=aj==1;var am=D("#confirm-container:visible").length>0;var ak=(J.PRODUCT_TYPE=="CPE"&&checkCableMode(ao.blc_wan_mode))?true:false;if(!ao.isLoggedIn||am||(p&&z)||!ao.limitVolumeEnable||(!aj&&!(ao.connectStatus=="ppp_connected"))||ak){return false}if(n){window.setTimeout(function(){n=false},2000);return false}var ap=Y(ao);if(ap.showConfirm){var al=null;if(ap.usedPercent>100&&!z){p=z=true;al={msg:aj?"traffic_beyond_msg":"traffic_beyond_disconnect_msg"}}else{if(!p){p=true;z=false;al={msg:aj?"traffic_limit_msg":"traffic_limit_disconnect_msg",params:[ap.limitPercent]}}}if(al!=null){if(aj){showAlert(al)}else{showConfirm(al,function(){showLoading("disconnecting");d.disconnect({},function(aq){if(aq.result){successOverlay()}else{errorOverlay()}})})}}}return true};function ad(aj){D("#statusItemSimStatus").attr("tipTitle","sim_status_"+aj.simStatus);if(aj.wifiStatus){if(aj.deviceSize==0){D("#wifi_status").attr("tipTitle","wifi_status_on")}else{D("#wifi_status").attr("tipTitle","wifi_status"+aj.deviceSize)}}else{D("#wifi_status").attr("tipTitle","wifi_status_off")}}function ac(al,aj,ak,am){al.connectStatus(aj);if(aj=="ppp_connecting"){al.connectStatusTrans("connecting");al.connectStatusText(D.i18n.prop("connecting"))}else{if(aj=="ppp_connected"){al.connectStatusTrans("connected");al.connectStatusText(D.i18n.prop("connected"))}else{if(aj=="ppp_disconnecting"){al.connectStatusTrans("disconnecting");al.connectStatusText(D.i18n.prop("disconnecting"))}else{if(ak){if(am=="connect"){al.connectStatus("wifi_connect");al.connectStatusTrans("connected");al.connectStatusText(D.i18n.prop("connected"))}else{if(am=="connecting"||am=="dhcping"){al.connectStatus("wifi_connecting");al.connectStatusTrans("connecting");al.connectStatusText(D.i18n.prop("connecting"))}else{al.connectStatus("ppp_disconnected");al.connectStatusTrans("disconnected");al.connectStatusText(D.i18n.prop("disconnected"))}}}else{al.connectStatusTrans("disconnected");al.connectStatusText(D.i18n.prop("disconnected"))}}}}}getNetworkType=function(ak){var aj=ak.toLowerCase();if(aj==""||aj=="limited service"){aj="limited_service"}if(aj=="no service"){aj="no_service"}if(aj=="limited_service"||aj=="no_service"){D("#networkType","#statusBar").attr("data-trans","network_type_"+aj);return D.i18n.prop("network_type_"+aj)}else{D("#networkType","#statusBar").removeAttr("data-trans");return ak}};if(J.HAS_SMS&&V.checkIsMenuExist("sms/smslist")){window.setInterval(function(){var ak=u();if(window.location.hash=="#login"||P(ak.simStatus)){return}for(key in W){var al=W[key];if(D.now()-al>5000){delete (W["m"+al]);var aj=D(".bubbleItem#m"+al,"#buttom-bubble");aj.fadeOut(1000,function(){D(this).remove()})}}if(ak.isLoggedIn){if(ak.newSmsReceived&&!x){x=true;d.resetNewSmsReceivedVar();ae()}if(ak.smsReportReceived){d.resetSmsReportReceivedVar();M()}}},1000);if(J.SMS_DATABASE_SORT_SUPPORT){window.setInterval(function(){if(V.checkIsMenuExist("sms/smslist")){var aj=u();if(aj.isLoggedIn&&i&&!x&&!P(aj.simStatus)){x=true;ae()}}},20001)}}function ae(){var ak=5;var aj=1;if(!J.dbMsgs||J.dbMsgs.length==0){ak=500;aj=10}d.getSMSMessages({page:0,smsCount:ak,nMessageStoreType:0,tags:aj,orderBy:"order by id desc"},function(al){if(al&&al.messages){L(al.messages,0)}x=false});d.getSMSMessages({page:0,smsCount:ak,nMessageStoreType:1,tags:aj,orderBy:"order by id desc"},function(al){if(al&&al.messages){L(al.messages,1)}x=false})}if(J.HAS_SMS){D(".bubbleItem","#buttom-bubble").live("mouseover",function(){var aj=D(this);delete (W[aj.attr("id")])}).live("mouseout",function(){var ak=D(this);var aj=D.now();W["m"+aj]=aj;ak.attr("id","m"+aj);D(".bubbleItem h3 a.bubbleCloseBtn","#buttom-bubble").data("targetid","m"+aj)});D(".bubbleItem h3 a.bubbleCloseBtn","#buttom-bubble").die().live("click",function(){var ak=D(this).data("targetid");delete (W[ak]);var aj=D(".bubbleItem#"+ak,"#buttom-bubble");aj.fadeOut(1000,function(){D(this).remove()})})}}var u=function(){return d.getStatusInfo()};function K(){var ac=this;var af=u();ac.isShowFotaNewversionIcon=U.observable(af.new_version_state&&af.fota_package_already_download!="yes"&&!J.isShowFotaIcon);ac.isShowConnectionIcon=U.observable(false);ac.isShowRj45ConnectionIcon=U.observable(false);ac.hasWifi=U.observable(J.HAS_WIFI);ac.hasBattery=U.observable(J.HAS_BATTERY);ac.updateType=U.observable(d.getUpdateType().update_type);ac.networkType=U.observable(getNetworkType(af.networkType));ac.signalCssClass=U.observable(X(af.signalImg,af.networkType,af.simStatus));var ad=af.roamingStatus?true:false;ac.networkOperator=U.observable(o(af.spn_b1_flag,af.spn_name_data,af.spn_b2_flag,af.networkOperator,ad));ac.roamingStatus=U.observable(af.roamingStatus?"R":"");ac.wifiStatusImg=U.observable(S(af.wifiStatus,af.wirelessDeviceNum));ac.wifiStatusCssClass=U.observable(t(af.wifiStatus,af.wirelessDeviceNum));ac.simStatus=U.observable(h(af.simStatus));ac.pinStatus=U.observable(af.pinStatus);ac.pinStatusText=U.observable();ac.batteryStatus=U.observable(af.batteryStatus);ac.batteryPers=U.observable(aa(af.batteryPers,af.batteryStatus));ac.batteryLevel=U.observable(af.batteryLevel+"%");ac.connectStatus=U.observable(af.connectStatus);ac.connectStatusText=U.observable();ac.connectStatusTrans=U.observable();ac.showAttachedDevices=U.observable(af.wifiStatus);ac.isLoggedIn=U.observable(af.isLoggedIn);ac.showSmsDeleteConfirm=U.observable(false);ac.smsUnreadCount=U.observable(0);ac.connectionCssClass=U.observable("");ac.rj45ConnectionCssClass=U.observable("");s(ac,af.connectStatus,af.data_counter,af.connectWifiSSID,af.connectWifiStatus,af.rj45ConnectStatus);var ae=D("#langLogoBar");if(af.isLoggedIn){if(!ae.hasClass("langborderBg")){ae.addClass("langborderBg")}D("#statusBar:hidden").show()}else{if(ae.hasClass("langborderBg")){ae.removeClass("langborderBg")}D("#statusBar:visible").hide()}ac.connect=function(){showLoading("connecting");d.connect({},function(ag){if(ag.result){refreshConnectStatus(ac,ag.status)}successOverlay()},function(ag){errorOverlay()})};ac.disconnect=function(){showLoading("disconnecting");d.disconnect({},function(ag){if(ag.result){refreshConnectStatus(ac,ag.status)}successOverlay()},function(ag){errorOverlay()})}}function o(ag,ac,af,ae,ad){if(ac==""){return ae}else{ac=decodeMessage(ac);if(ag=="1"&&af=="1"){if(ad){return ae}else{return ac==ae?ae:(ac+"  "+ae)}}else{if(ag=="1"){return ac==ae?ae:(ac+"  "+ae)}else{if(af=="1"){if(ad){return ae}else{return ac}}else{if(ag=="0"&&af=="0"){if(ad){return ac==ae?ae:(ac+"  "+ae)}else{return ac}}}}}return""}}var j=[];function L(ad,ac){if(!J.dbMsgs){J.dbMsgs=[]}if(j.length==0){D.each(J.dbMsgs,function(ae,af){j.push(af.id)})}D.each(ad,function(ae,ag){if(D.inArray(ag.id,j)==-1){j.push(ag.id);J.dbMsgs.push(ag);if(ag.tag=="1"){k(ag,false,ac)}}else{for(var af=0;af<J.dbMsgs.length;af++){if(J.dbMsgs[af].id==ag.id&&J.dbMsgs[af].content!=ag.content&&ag.tag=="1"){J.dbMsgs[af].content=ag.content;k(ag,true,ac);break}}}})}var a=true;var E=null;function k(af,at,an){J.smsMaxId=af.id;var ad=D.now();W["m"+ad]=ad;var ac=af.number;if(a&&J.phonebook&&J.phonebook.length==0){a=false;if(J.HAS_PHONEBOOK){N()}else{J.phonebook=[]}}for(ai in J.phonebook){if(getLastNumber(J.phonebook[ai].pbm_number,J.SMS_MATCH_LENGTH)==getLastNumber(af.number,J.SMS_MATCH_LENGTH)){ac=J.phonebook[ai].pbm_name;break}}var ae={mark:"m"+ad,name:ac,title:D.i18n.prop("sms"),titleTrans:"sms",tag:af.tag,content:af.content,datetime:af.time};if(E==null){E=D.template("newMessagePopTmpl",D("#newMessagePopTmpl"))}D(".bubbleItem:not(.report)","#buttom-bubble").remove();D.tmpl("newMessagePopTmpl",ae).appendTo("#buttom-bubble");if((window.location.hash=="#sms"||window.location.hash=="#smslist")&&an=="1"){var aj=J.currentChatObject&&J.currentChatObject==getLastNumber(af.number,J.SMS_MATCH_LENGTH);var ao=getLastNumber(af.number,J.SMS_MATCH_LENGTH);var ar=D("#smslist-item-"+ao);if(ar&&ar.length>0){for(var ai=0;J.listMsgs&&ai<J.listMsgs.length;ai++){if(getLastNumber(J.listMsgs[ai].number,J.SMS_MATCH_LENGTH)==getLastNumber(af.number,J.SMS_MATCH_LENGTH)){J.listMsgs[ai].id=af.id;J.listMsgs[ai].latestId=af.id;J.listMsgs[ai].latestSms=af.content;J.listMsgs[ai].latestTime=af.time;if(!at){J.listMsgs[ai].newCount++;J.listMsgs[ai].totalCount++}break}}ar.find(".smslist-item-checkbox p.checkbox").attr("id",af.id);ar.find(".smslist-item-checkbox input:checkbox").val(af.id).attr("id","checkbox"+af.id);if(!at){var al=ar.find(".smslist-item-total-count").text();al=Number(al.substring(1,al.length-1));ar.find(".smslist-item-total-count").text("("+(al+1)+")");if(!J.currentChatObject||J.currentChatObject!=getLastNumber(af.number,J.SMS_MATCH_LENGTH)){var ah=ar.find(".smslist-item-new-count").removeClass("hide");if(ah&&ah.text().length>0){ah.text(Number(ah.text())+1)}else{ah.text(1)}}}if(ar.find(".smslist-item-draft-flag").length>0){if(J.currentChatObject&&J.currentChatObject==getLastNumber(af.number,J.SMS_MATCH_LENGTH)){ar.find(" td:nth-child(2)").removeClass("font-weight-bold")}else{ar.find(" td:nth-child(2)").addClass("font-weight-bold")}}else{var ag=ar.find(".smslist-item-msg").text(af.content);ag.closest("td").prop("title",af.content);ar.find("span.clock-time").text(af.time);if(J.currentChatObject&&J.currentChatObject==getLastNumber(af.number,J.SMS_MATCH_LENGTH)){ag.closest("tr").removeClass("font-weight-bold")}else{ag.closest("tr").addClass("font-weight-bold")}}ar.find(".smslist-item-repeat span").die().click(function(){forwardClickHandler(af.id)});var aq=ar;ar.hide().remove();D("#smslist-table").prepend(aq.show())}else{var ak="";if(J.phonebook&&J.phonebook.length>0){for(ai in J.phonebook){if(getLastNumber(J.phonebook[ai].pbm_number,J.SMS_MATCH_LENGTH)==getLastNumber(af.number,J.SMS_MATCH_LENGTH)){ak=J.phonebook[ai].pbm_name;break}}}var am={id:af.id,name:ak,number:af.number,latestId:af.id,totalCount:1,newCount:aj?0:1,latestSms:af.content,latestTime:af.time,checked:false,hasDraft:false,itemId:getLastNumber(af.number,J.SMS_MATCH_LENGTH)};if(O==null){O=D.template("smsTableTmpl",D("#smsTableTmpl"))}D.tmpl("smsTableTmpl",{data:[am]}).prependTo("#smslist-table")}if(J.HAS_PHONEBOOK){D(".sms-add-contact-icon").removeClass("hide")}else{D(".sms-add-contact-icon").addClass("hide")}if(aj){var ap=D("#talk-item-"+af.id,"#chatlist");if(ap&&ap.length>0){D(".J_content pre",ap).html(dealContent(af.content));D(".time .smslist-item-time",ap).text(af.time);D(".smslist-item-repeat",ap).die().click(function(){forwardClickHandler(af.id)});D(".smslist-item-delete",ap).die().click(function(){deleteSingleItemClickHandler(af.id)})}else{D("#smsOtherTmpl").tmpl(af).appendTo("#chatlist");D(".clear-container","#chatpanel").animate({scrollTop:D("#chatlist").height()})}if(!J.SMS_SET_READ_WHEN_COMPLETE){d.setSmsRead({ids:[af.id]},D.noop)}else{if(J.SMS_SET_READ_WHEN_COMPLETE&&af.receivedAll){d.setSmsRead({ids:[af.id]},D.noop)}}}enableCheckbox(D("#smslist-checkAll"))}if(window.location.hash=="#sim_messages"&&an=="0"){var ak="";if(J.phonebook&&J.phonebook.length>0){for(ai in J.phonebook){if(getLastNumber(J.phonebook[ai].pbm_number,J.SMS_MATCH_LENGTH)==getLastNumber(af.number,J.SMS_MATCH_LENGTH)){ak=J.phonebook[ai].pbm_name;break}}}var am={id:af.id,name:ak,number:af.number,content:af.content,time:af.time,tag:af.tag,checked:false,itemId:getLastNumber(af.number,J.SMS_MATCH_LENGTH)};if(at){var ar=D(".simMsgList-item-class-"+am.id);ar.hide().remove()}if(B==null){B=D.template("simMsgListTmpl",D("#simMsgListTmpl"))}D.tmpl("simMsgListTmpl",{data:[am]}).prependTo("#simMsgList_container")}}function w(ad,ac){setTimeout(function(){var ae=D("#chosenUserSelect");var af=D("option",ae);for(var ag=0;ag<af.length;ag++){if(getLastNumber(ac,J.SMS_MATCH_LENGTH)==af[ag].value){af[ag].value=ac;af[ag].text=ad+"/"+ac;break}}ae.trigger("liszt:updated")},0)}function M(){if(a&&J.phonebook&&J.phonebook.length==0){a=false;if(J.HAS_PHONEBOOK){N()}else{J.phonebook=[]}}d.getSMSDeliveryReport({page:0,smsCount:10},function(ad){var ac=ad.messages;var ae=[];D.each(ac,function(af,ag){if(D.inArray(ag.number,ae)==-1){ae.push(ag.number);window.setTimeout(function(){var ai=D.now();W["m"+ai]=ai;ag.name=ag.number;for(af in J.phonebook){if(getLastNumber(J.phonebook[af].pbm_number,J.SMS_MATCH_LENGTH)==getLastNumber(ag.number,J.SMS_MATCH_LENGTH)){ag.name=J.phonebook[af].pbm_name;break}}var aj=D.i18n.prop("sms_delivery_report_"+ag.content);var ah={mark:"m"+ai,name:ag.name,title:D.i18n.prop("sms_report"),titleTrans:"sms_report",content:aj,datetime:ag.time,report:"report"};if(E==null){E=D.template("newMessagePopTmpl",D("#newMessagePopTmpl"))}D(".report","#buttom-bubble").remove();D.tmpl("newMessagePopTmpl",ah).appendTo("#buttom-bubble")},100)}})},function(){})}function N(){var ac=d.getPhoneBooks({page:0,data_per_page:2000,orderBy:"id",isAsc:false});r(ac)}function r(ac){if(D.isArray(ac.pbm_data)&&ac.pbm_data.length>0){J.phonebook=ac.pbm_data}}function X(ae,ad,ac){ad=ad.toLowerCase();ac=ac?ac.toLowerCase():"";if(ad==""||ad=="limited_service"||ad=="no_service"||ad=="limited service"||ad=="no service"||ac!="modem_init_complete"){ae="_none"}return"signal signal"+ae}function P(ac){return ac=="modem_sim_undetected"||ac=="modem_undetected"||ac=="modem_sim_destroy"||ac=="modem_waitpin"||ac=="modem_waitpuk"||ac=="modem_imsi_waitnck"}function s(ag,ac,af,ae,aj,ah){var ad="icon_connection ";var ai="icon_connection ";if(ac=="ppp_disconnected"){if(ae&&aj=="connect"){d.getHotspotList({},function(an){var ao="icon_connection ";var am="connecting ";for(var al=0,ak=an.hotspotList.length;al<ak;al++){if(an.hotspotList[al].connectStatus=="1"){am="wifi_connected";break}}ao+=am;ag.connectionCssClass(ao)});return}else{if(ae&&(aj=="connecting"||aj=="dhcping")){ad+="connecting"}else{ad+="disconnect"}}}else{if(ac=="ppp_connecting"||ac=="wifi_connecting"){ad+="connecting"}else{if(ac=="ppp_connected"){if(af.uploadRate!="0"&&af.downloadRate!="0"){ad+="connectionBoth"}else{if(af.uploadRate!="0"&&af.downloadRate=="0"){ad+="connectionUp"}else{if(af.uploadRate=="0"&&af.downloadRate!="0"){ad+="connectionDown"}else{ad+="connectionNone"}}}}else{ad+="disconnect"}}}if(ah=="working"){ai+="rj45_connected"}else{if(ah=="connect"){ai+="connecting"}else{ai+="disconnect"}}ag.connectionCssClass(ad);ag.rj45ConnectionCssClass(ai)}function S(ac,ad){if(ac){if(ad==0){return"./pic/wifi0.png"}else{return"./pic/wifi"+ad+".png"}}else{return"./pic/wifi_off.png"}}function t(ac,ad){if(ac){if(ad==0){return"wifi_status0"}else{return"wifi_status"+ad}}else{return"wifi_status_off"}}function h(ad){var ac;switch(ad){case"modem_init_complete":ac="./pic/sim_detected.png";break;case"modem_waitpin":ac="./pic/sim_undetected.png";break;case"modem_waitpuk":ac="./pic/sim_undetected.png";break;case"modem_sim_undetected":ac="./pic/sim_undetected.png";break;case"modem_undetected":ac="./pic/sim_undetected.png";break;case"modem_imsi_waitnck":ac="./pic/sim_undetected.png";break;case"modem_sim_destroy":ac="./pic/sim_undetected.png";break;case"modem_destroy":ac="./pic/sim_undetected.png";break;default:ac="./pic/sim_detected.png";break}return ac}function aa(ae,ac){var ad=null;if("0"==ac){if("1"==ae){ad="pic/battery_one.png"}else{if("2"==ae){ad="pic/battery_two.png"}else{if("3"==ae){ad="pic/battery_three.png"}else{if("4"==ae){ad="pic/battery_full.png"}else{ad="pic/battery_out.png"}}}}}else{ad="pic/battery_charging.gif"}return ad}gotoSmsList=function(){var ac="#sms";if(window.location.hash=="#sms"){ac="#smslist"}J.CONTENT_MODIFIED.checkChangMethod();if(checkFormContentModify(ac)){window.location.hash=ac}};function I(ad){if((!(D("#loading").is(":visible")))&&(!(D("#confirm").is(":visible")))){var ac=ad?"ota_update_success":"ota_update_failed";g=true;showAlert(ac,function(){g=false;if(J.UPGRADE_TYPE=="OTA"){d.clearUpdateResult({},D.noop())}})}else{window.setTimeout(function(){I(ad)},1000)}}var m=0;function A(){var ac=d.getCurrentUpgradeState();if(ac.current_upgrade_state=="low_battery"){showInfo("ota_low_battery");clearInterval(m)}}var y=0;function Q(){F=true;var ac=d.getNewVersionState();function af(){var ag=["downloading"];var ah=d.getCurrentUpgradeState();if(ah.current_upgrade_state.toLowerCase()=="idle"){addTimeout(af,1000)}else{if((D.inArray(ah.current_upgrade_state,ag)!=-1)&&(ac.fota_new_version_state!="already_has_pkg")){hideLoading();q()}}}if(!(D("#progress").is(":visible"))){af()}var ae=0;var ad=function(){var ah=null;if(ae<=3){ae=ae+1;ah=d.getCurrentUpgradeState()}else{ah=u()}var ag=ah.current_upgrade_state;if(F&&T==true){if(ac.fota_new_version_state=="already_has_pkg"){if(ag=="low_battery"){hideProgressBar();F=false;d.removeTimerThings("fota_current_upgrade_state",function(){});showInfo("ota_pkg_low_battery");window.clearTimeout(y);return}else{if(ag=="prepare_install"){hideProgressBar();F=false;d.removeTimerThings("fota_current_upgrade_state",function(){});showInfo("ota_pkg_download_success");window.clearTimeout(y);m=setInterval(function(){A()},1000);return}}}else{if(ag=="downloading"){e()}else{if(ag=="download_failed"){hideProgressBar();F=false;showAlert("ota_download_failed");window.clearTimeout(y);return}else{if(ag=="low_battery"){hideProgressBar();F=false;d.removeTimerThings("fota_current_upgrade_state",function(){});showInfo("ota_low_battery");window.clearTimeout(y);return}else{if(ag=="prepare_install"){hideProgressBar();F=false;d.removeTimerThings("fota_current_upgrade_state",function(){});showInfo("ota_download_success");window.clearTimeout(y);m=setInterval(function(){A()},1000);return}else{F=false;hideProgressBar();window.clearTimeout(y);return}}}}}y=window.setTimeout(ad,1000)}};if(F&&T==true){y=window.setTimeout(ad,100)}else{window.clearTimeout(y)}}function f(ac){var ae=u();if(ac){var ad=d.getOpMode();if(!checkConnectedStatus(ae.connectStatus,ad.rj45_state,ae.connectWifiStatus)){showAlert("ota_network_disconnected");return}if(ae.fota_user_selector=="none"){Z()}else{if(ae.fota_user_selector=="accept"){Q()}else{if(ae.fota_user_selector=="cancel"){showAlert("ota_have_cancel")}else{if(ae.fota_user_selector=="downloading_cancel"){showAlert("ota_have_cancel")}}}}}else{if(ae.fota_user_selector=="none"){G()}else{if(ae.fota_user_selector=="accept"){Q()}else{if(ae.fota_user_selector=="cancel"){}else{if(ae.fota_user_selector=="downloading_cancel"){}}}}}}function e(){d.getPackSizeInfo({},function(ad){var ac;if(parseInt(ad.fota_pkg_total_size)==0){ac=0}else{ac=parseInt(parseInt(ad.fota_dl_pkg_size)*100/parseInt(ad.fota_pkg_total_size))}if(ac>100){ac=100}if(ac>=0){if(ac>95){showProgressBar("ota_update","<br/>"+D.i18n.prop("ota_update_warning"))}setProgressBar(ac)}})}function Z(){d.setUpgradeSelectOp({selectOp:"1"},function(ac){if(ac.result=="success"){Q()}})}function G(){d.setUpgradeSelectOp({selectOp:"0"},function(ac){})}function q(){var ae=d.getMandatory();var ad=ae.is_mandatory;var af=d.getPackSizeInfo();var ac;if(parseInt(af.fota_pkg_total_size)==0){ac=0}else{ac=parseInt(parseInt(af.fota_dl_pkg_size)*100/parseInt(af.fota_pkg_total_size))}if(ac>100){ac=100}if(ad){showProgressBar("ota_update","<br/>"+D.i18n.prop("ota_update_warning"))}else{var ag="";if(J.UPGRADE_TYPE=="OTA"){ag="<br/><br/><button id='btnStopUpgrade' onclick='stopOTAUpgrade();' class='btn-1 btn-primary'>"+D.i18n.prop("cancel")+"</button>"}showProgressBar("ota_update","<br/>"+D.i18n.prop("ota_update_warning")+ag)}if(ac>=0){setProgressBar(ac)}}function v(ae){var ad=ae.current_upgrade_state;if(ad=="upgrade_pack_redownload"){showConfirm("ota_interrupted",{ok:function(){f(1)},no:function(){f(0)}})}else{var ac=["prepare_install","low_battery","connecting_server","connect_server_success","downloading","accept"];if(D.inArray(ad,ac)!=-1){Q()}else{showConfirm(D.i18n.prop("ota_new_version"),{ok:function(){f(1);J.ISNOW_NOTICE=false},no:function(){f(0);J.ISNOW_NOTICE=false}})}}}showOTAAlert=function(){J.ISNOW_NOTICE=true;var ac=d.getMandatory().is_mandatory;if(ac){Q()}else{var ad={};ad=d.getCurrentUpgradeState();v(ad)}};stopOTAUpgrade=function(){d.setUpgradeSelectOp({selectOp:"2"},function(ac){});F=false;window.clearTimeout(y);hideLoading();showAlert("ota_cancel")};function c(ac){p=!!ac;z=!!ac;if(!ac){n=true}}function l(ac){z=!!ac;if(!ac){n=true}}function Y(ad){var ae={showConfirm:false,limitPercent:ad.limitVolumePercent};if(ad.limitVolumeType=="1"){var ac=parseInt(ad.data_counter.monthlySent,10)+parseInt(ad.data_counter.monthlyReceived,10);ae.usedPercent=ac/ad.limitVolumeSize*100;if(ae.usedPercent>ae.limitPercent){ae.showConfirm=true;ae.type="data"}}else{ae.usedPercent=ad.data_counter.monthlyConnectedTime/ad.limitVolumeSize*100;if(ae.usedPercent>ae.limitPercent){ae.showConfirm=true;ae.type="time"}}return ae}return{init:R,setTrafficAlertPopuped:c,setTrafficAlert100Popuped:l,getTrafficResult:Y,showOTAAlert:showOTAAlert}});