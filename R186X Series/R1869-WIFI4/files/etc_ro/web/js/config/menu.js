define(["knockout","underscore","jquery","service","config/config"],function(b,s,i,t,r){var g=false;var m;var c=[];r.blc_wan_mode=t.getOpMode().blc_wan_mode;if(r.RJ45_SUPPORT){switch(r.blc_wan_mode){case"PPPOE":case"AUTO_PPPOE":a="menu_pppoe";break;case"PPP":case"AUTO_PPP":a="menu_4ggateway";break;default:a="menu";break}}else{a="menu"}require(["config/"+r.DEVICE+"/"+a],function(u){c=u;if(r.SD_CARD_SUPPORT){c=c.concat([{hash:"#httpshare_guest",path:"sd/httpshare",level:"",requireLogin:false,checkSIMStatus:false},{hash:"#sdcard",path:"sd/sd",level:"",requireLogin:true,checkSIMStatus:false},{hash:"#httpshare",path:"sd/httpshare",level:"",requireLogin:true,checkSIMStatus:false}])}});var a="";function k(){var u=this;var x=h();u.loggedIn=b.observable(x);u.showMenu=b.observable(x||g);var w=s.filter(c,function(y){return(y.level=="1"&&((y.requireLogin&&u.loggedIn())||!y.requireLogin)&&y.hash!="#login")});u.mainMenu=b.observableArray(w);u.secondMenu=b.observableArray([]);u.curThirdMenu;u.getThirdMenu=function(y){u.curThirdMenu=v(y)};u.thirdMenu=function(){return u.curThirdMenu};u.changeMenu=function(y){var z=v(y);if(z.length==0){i("#container").addClass("fixContainerWidth")}else{i("#container").removeClass("fixContainerWidth")}u.secondMenu(z);return true};function v(y){return s.filter(c,function(z){return((z.parent&&z.parent==y.hash)&&((z.requireLogin&&u.loggedIn())||!z.requireLogin))})}}function f(){var w=window.location.hash;var u=s.find(c,function(x){return x.hash==w});while(u.parent){u=s.find(c,function(x){return x.hash==u.parent})}if(!u.parent){i("#list-nav li").removeClass("active");var v=u.hash.substring(1,u.hash.length);i("#list-nav li[mid="+v+"]").addClass("active")}m.changeMenu(u)}function q(){var v=window.location.hash;var u=s.find(c,function(w){return w.hash==v});if(u.level==1){l("two",u)}if(u.level==2){l("three",u);e(u.hash,u.level)}if(u.level==3){e(u.parent,u.level);i(".menu-three-level").removeClass("active");i(".menu-three-level."+u.hash.substring(1)).addClass("active")}}function l(w,v){var u=s.find(c,function(x){return x.parent==v.hash&&x.path==v.path});i(".menu-"+w+"-level").removeClass("active");if(u){if(w=="two"){l("three",u);e(u.hash,w)}i(".menu-"+w+"-level."+u.hash.substring(1)).addClass("active")}}function e(v,w){$obj=i(".menu-two-level."+v.substring(1));var u=["3","three","2","two"];if(s.indexOf(u,w)!=-1&&$obj.hasClass("active")){return}$obj.siblings().removeClass("active");$obj.addClass("active");$obj.siblings().not(".menu-two-level").slideUp();$obj.next().has("ul li").slideDown()}function o(){m=new k()}function n(v){v=v||window.location.hash;var u=h();return s.filter(c,function(w){return(v==w.hash&&((w.requireLogin&&u)||!w.requireLogin))})}function d(){var u=h();var v=s.filter(c,function(w){return(w.level=="1"&&((w.requireLogin&&u)||!w.requireLogin)&&w.hash!="#login")});m.mainMenu(v);m.loggedIn(u);j(m.mainMenu().length);m.showMenu(u||g);i("#nav").translate()}function j(u){var v=100/u;i("ul#list-nav li").each(function(){i(this).css("width",v+"%")})}function h(){var u=t.getLoginStatus();return(u.status=="loggedIn")}function p(v){for(var u=0;u<c.length;u++){if(c[u].path==v){return true}}return false}return{init:o,refreshMenu:f,findMenu:n,activeSubMenu:q,rebuild:d,checkIsMenuExist:p}});