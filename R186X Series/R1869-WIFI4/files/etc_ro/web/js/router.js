define(["config/menu","jquery","config/config","service","underscore"],function(b,f,c,g,i){var e="";var a=f("#container");function j(){m();window.location.hash=window.location.hash||"#home";if(("onhashchange" in window)&&((typeof document.documentMode==="undefined")||document.documentMode==8)){window.onhashchange=h;h()}else{setInterval(h,200)}f("a[href^='#']").die("click").live("click",function(){var n=f(this);c.CONTENT_MODIFIED.checkChangMethod();return checkFormContentModify(n.attr("href"))})}checkFormContentModify=function(n){if(c.CONTENT_MODIFIED.modified&&window.location.hash!=n){if(c.CONTENT_MODIFIED.message=="sms_to_save_draft"){c.CONTENT_MODIFIED.callback.ok(c.CONTENT_MODIFIED.data);c.resetContentModifyValue();window.location.hash=n}else{showConfirm(c.CONTENT_MODIFIED.message,{ok:function(){c.CONTENT_MODIFIED.callback.ok(c.CONTENT_MODIFIED.data);c.resetContentModifyValue();window.location.hash=n},no:function(){var o=c.CONTENT_MODIFIED.callback.no(c.CONTENT_MODIFIED.data);if(!o){window.location.hash=n;c.resetContentModifyValue()}}})}return false}else{return true}};function m(){setInterval(function(){var s=g.getStatusInfo();var n=b.findMenu();if(n.length==0){return false}var r=["phonebook/phonebook","sms/smslist"];var o=(f.inArray(n[0].path,r)!=-1);if(n[0].checkSIMStatus===true){var q=s.simStatus=="modem_sim_undetected"||s.simStatus=="modem_sim_destroy"||s.simStatus=="modem_waitpin"||s.simStatus=="modem_waitpuk";var p=s.simStatus=="modem_imsi_waitnck";if(s.isLoggedIn&&((f("#div-nosimcard")[0]==undefined&&q)||(f("#div-network-lock")[0]==undefined&&p)||((f("#div-nosimcard")[0]!=undefined||f("#div-network-lock")[0]!=undefined)&&s.simStatus=="modem_init_complete"))){d(n[0],s.simStatus,o)}}},1000)}function l(){var o=window.location.hash;if(o=="#login"||i.indexOf(c.GUEST_HASH,o)!=-1){f("#manageContainer").attr("style","margin-top:-36px;")}else{f("#manageContainer").attr("style","margin-top:0px;")}if(window.location.hash=="#login"){f("#mainContainer").addClass("loginBackgroundBlue")}else{var n=f("#mainContainer");if(n.hasClass("loginBackgroundBlue")){f("#container").css({margin:0});n.removeClass("loginBackgroundBlue").height("auto")}}}function h(){if(window.location.hash!=e){var s=g.getStatusInfo();if(window.location.hash==c.defaultRoute||i.indexOf(c.GUEST_HASH,window.location.hash)!=-1){if(s.isLoggedIn){window.location.hash=e==""?"#home":e;return}}var p=b.findMenu();if(p.length==0){window.location.hash=c.defaultRoute}else{if(c.RJ45_SUPPORT&&window.location.hash=="#home"){if((p[0].checkSIMStatus&&checkCableMode(s.blc_wan_mode))||(!p[0].checkSIMStatus&&!checkCableMode(s.blc_wan_mode))){window.location.reload();return}}var n=b.findMenu(e);e=p[0].hash;if(e=="#login"){f("#indexContainer").addClass("login-page-bg");b.rebuild()}else{f("#indexContainer").removeClass("login-page-bg")}if(n.length!=0&&p[0].path==n[0].path&&p[0].level!=n[0].level&&p[0].level!="1"&&n[0].level!="1"){return}l();var r=["phonebook/phonebook","sms/smslist"];var q=(f.inArray(p[0].path,r)!=-1);if(p[0].checkSIMStatus===true||q){if(s.simStatus==undefined){showLoading("waiting");function o(){var t=g.getStatusInfo();if(t.simStatus==undefined||f.inArray(t.simStatus,c.TEMPORARY_MODEM_MAIN_STATE)!=-1){addTimeout(o,500)}else{d(p[0],t.simStatus,q);hideLoading()}}o()}else{d(p[0],s.simStatus,q)}}else{k(p[0])}}}}function d(p,n,o){var q={};f.extend(q,p);if(n=="modem_sim_undetected"||n=="modem_sim_destroy"){if(!o){q.path="nosimcard"}}else{if(n=="modem_waitpin"||n=="modem_waitpuk"){q.path="nosimcard"}else{if(n=="modem_imsi_waitnck"){q.path="network_lock"}}}k(q)}function k(p){var o=p.path.replace(/\//g,"_");var q=f("body").removeClass();if(o!="login"&&o!="home"){q.addClass("beautiful_bg page_"+o)}else{q.addClass("page_"+o)}clearTimer();hideLoading();var n="text!tmpl/"+p.path+".html";require([n,p.path],function(r,s){a.stop(true,true);a.hide();a.html(r);s.init();b.refreshMenu();f("#container").translate();b.activeSubMenu();f("form").attr("autocomplete","off");a.fadeIn()})}return{init:j}});