define(["jquery","knockout","config/config","service","underscore"],function(e,k,a,g,i){var c=i.map(a.AUTO_MODES,function(m){return new Option(m.name,m.value)});function h(){var m=this;m.enableFlag=k.observable(true);m.types=k.observableArray(c);m.selectedType=k.observable();m.selectMode=k.observable();m.networkList=k.observableArray([]);m.selectNetwork=k.observable("");m.networkStatus=function(o){return e.i18n.prop(f(o.nState))};m.networkStatusId=function(o){return f(o.nState)};m.networkText=function(o){return o.strNumeric};m.operatorName=function(o){return o.strShortName};m.networkType=function(p){var o=d(p.nRat);if(o=="auto"){o=e.i18n.prop("auto")}return o};m.subnetworkType=function(p){var o=l(p.nRat,p.SubAct);return o};m.networkTypeId=function(o){return d(o.nRat)};m.subnetTypeId=function(o){return l(o.nRat,o.SubAct)};m.networkValue=function(p){var o=[];o.push(p.strNumeric);o.push(p.nRat);o.push(p.SubAct);o.push(p.nState);return o.join(",")};m.save=function(){showLoading();var o={};o.strBearerPreference=m.selectedType();g.setBearerPreference(o,function(p){if(p.result=="success"){m.networkList([]);successOverlay()}else{errorOverlay()}})};m.search=function(){showLoading("searching_net");g.scanForNetwork(function(o,q){hideLoading();if(o){m.networkList(q);for(var p=0;p<q.length;p++){var r=q[p];if(r.nState=="2"){m.selectNetwork(r.strNumeric+","+r.nRat+","+r.SubAct+","+r.nState);return}}}else{m.networkList([])}})};m.register=function(){showLoading("registering_net");var o=m.selectNetwork().split(",");if(o[3]=="3"){showOverLay("net_forbidden","overlay-error")}else{g.setNetwork(o[0],parseInt(o[1]),parseInt(o[2]),function(p){if(p){m.networkList([]);var q=b();m.selectedType(q.net_select);successOverlay()}else{errorOverlay()}})}};m.checkEnable=function(){var o=g.getStatusInfo();if(o.connectStatus=="ppp_connected"||o.connectStatus=="ppp_connecting"){m.enableFlag(false)}else{m.enableFlag(true)}};m.checkEnable();var n=b();if("manual_select"==n.net_select_mode||"manual_select"==n.m_netselect_save){m.selectMode("manual_select")}else{m.selectMode("auto_select")}m.selectedType(n.net_select)}function b(){return g.getNetSelectInfo()}function f(m){if("0"==m){return"unknown"}else{if("1"==m){return"available"}else{if("2"==m){return"current"}else{if("3"==m){return"forbidden"}}}}}function d(m){if("0"==m){return"2G"}else{if("2"==m){return"3G"}else{if("7"==m){return"4G"}else{return"auto"}}}}function l(n,m){var o=[2,4,5,6,8];if("0"==m){if(e.inArray(n,o)!=-1){m="TD-SCDMA"}else{if("7"==n){m="TD-LTE"}else{m="GSM"}}}else{if("1"==m){if(e.inArray(n,o)!=-1){m="WCDMA"}else{if("7"==n){m="FDD-LTE"}else{m="GSM"}}}else{m=""}}return m}function j(){var m=e("#container");k.cleanNode(m[0]);var n=new h();k.applyBindings(n,m[0]);addInterval(n.checkEnable,1000)}return{init:j}});